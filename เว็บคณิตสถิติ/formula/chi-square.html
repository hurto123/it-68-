<!DOCTYPE html>
<html lang="th">
<head>
  <link rel="preload" href="../assets/fonts/NotoSerifThai-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="../assets/fonts/NotoSansThai-SemiBold.ttf" as="font" type="font/ttf" crossorigin>
  <link rel="preload" href="../assets/fonts/NotoSansThai-Regular.ttf" as="font" type="font/ttf" crossorigin>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chi-Square Distribution (‡πÑ‡∏Ñ‡∏™‡πÅ‡∏Ñ‡∏ß‡∏£‡πå) | ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏π‡∏ï‡∏£</title>
  <meta name="description" content="‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡πÑ‡∏Ñ‡∏™‡πÅ‡∏Ñ‡∏ß‡∏£‡πå: PDF, CDF, ‡∏Ñ‡πà‡∏≤ p ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ï‡πâ‡πÇ‡∏Ñ‡πâ‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÅ‡∏ö‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÅ‡∏≠‡∏Å‡∏ó‡∏µ‡∏ü">
  <meta property="og:title" content="Chi-Square Distribution (‡πÑ‡∏Ñ‡∏™‡πÅ‡∏Ñ‡∏ß‡∏£‡πå) | ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏π‡∏ï‡∏£">
  <meta property="og:description" content="‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì P(œá¬≤), ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï, ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Å‡∏£‡∏≤‡∏ü‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ï‡πâ‡πÇ‡∏Ñ‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö">
  <meta name="doc:version" content="1.0.0">
  <meta name="doc:updated_at" content="2025-10-03">
  <meta name="doc:depends_on" content="lesson09.html,summary-lesson09.html,glossary.html#gl-dist">

  <script defer src="../assets/js/site-core.js"></script>
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']] }
    };
  </script>
  <script async id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../print.css" media="print">

  <style>
    .wrap{max-width:1020px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media(max-width:900px){.grid2{grid-template-columns:1fr}}
    .formula-box{background:#0f1320;border:1px solid var(--border);border-radius:12px;padding:.8rem;overflow:auto}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    table{width:100%;border-collapse:collapse;margin:.5rem 0}
    th,td{border:1px solid var(--border);padding:.45rem .5rem;text-align:center}
    th{background:#101525}
    .ok{background:#0f231c;border-left:4px solid var(--ok);padding:.6rem;border-radius:12px}
    .warn{background:#231b0f;border-left:4px solid var(--warn);padding:.6rem;border-radius:12px}
    .calc-row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
    input[type="number"], select{
      background:#0b0f19;border:1px solid var(--border);border-radius:10px;color:#e8e8ea;padding:.45rem .55rem;
    }
    input[type="number"]{ width:120px; }
    canvas{width:100%;height:260px;background:#0c111b;border:1px solid var(--border);border-radius:12px}
    .badge{display:inline-block;border:1px solid var(--border);padding:.2rem .5rem;border-radius:999px;background:#0e1220;color:#cfe0ff;margin-left:.35rem}
    .mini{font-size:.9rem}
    .step{margin:.25rem 0}
    .chipline{display:flex;gap:.4rem;flex-wrap:wrap}
    .chip2{display:inline-block;border:1px solid var(--border);background:#0e1220;color:#cfe0ff;border-radius:999px;padding:.15rem .55rem;font-size:.85rem}
    .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
  </style>
</head>
<body>
  <a class="skip-link" href="#main-content">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</a>
<header role="banner">
  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <h1>Formula Explorer</h1>
    </div>
    <nav class="breadcrumb" aria-label="breadcrumb">
      <a href="../index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a> ‚Ä∫ <span class="muted">Chi-Square</span>
    </nav>
    <div class="title" style="display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;flex-wrap:wrap;padding:.6rem 0 1.0rem">
      <div>
        <h2 style="margin:.2rem 0;font-size:1.8rem">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡πÅ‡∏à‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏Ñ‡∏™‡πÅ‡∏Ñ‡∏ß‡∏£‡πå (Chi-Square) üîß</h2>
        <p class="muted">‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Z ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô: \(X^2=\sum Z_i^2\)</p>
      </div>
      <div class="toolbar">
        <a class="btn secondary" href="../glossary.html">Glossary</a>
        <a class="btn ghost" href="../lesson09.html">‡∏ö‡∏ó‡∏ó‡∏µ‡πà 9</a>
        <a class="btn ghost" href="../summary-lesson09.html">‡∏™‡∏£‡∏∏‡∏õ 1 ‡∏´‡∏ô‡πâ‡∏≤</a>
        <button class="btn" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å PDF</button>
        <button class="btn" id="btn-save-png">üì• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡πá‡∏ô PNG</button>
      </div>
    </div>
  </div>
</header>

<main id="main-content" class="wrap grid" role="main">
  <section class="card grid2">
    <div>
      <h3>1) ‡∏ó‡∏µ‡πà‡∏°‡∏≤ &amp; ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥</h3>
      <ul class="list-compact">
        <li>‡∏ñ‡πâ‡∏≤ \(Z_i \sim \mathcal{N}(0,1)\) ‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏Å‡∏±‡∏ô \(i=1..ŒΩ\) ‚Üí \(X^2=\sum Z_i^2 \sim \chi^2(ŒΩ)\)</li>
        <li>‡πÑ‡∏°‡πà‡∏™‡∏°‡∏°‡∏≤‡∏ï‡∏£ (‡πÄ‡∏ö‡πâ‡∏Ç‡∏ß‡∏≤) ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠ df ‡πÄ‡∏•‡πá‡∏Å; df ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‚Üí ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏õ‡∏Å‡∏ï‡∏¥</li>
        <li>‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡πà‡∏≤ \(x\ge 0\) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</li>
      </ul>
      <div class="ok" style="margin-top:.4rem">
        <strong>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> ‡∏≠‡∏ô‡∏∏‡∏°‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô/‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ö‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô, ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏≠‡∏î‡∏µ (Goodness-of-Fit), Independence test
      </div>
    </div>
    <div>
      <h3>2) ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå/‡∏™‡∏π‡∏ï‡∏£</h3>
      <div class="formula-box mono">
        X¬≤ ~ œá¬≤(ŒΩ), ŒΩ=df&gt;0<br/>
        PDF: f(x) = 1/(2^{ŒΩ/2} Œì(ŒΩ/2)) ¬∑ x^{ŒΩ/2‚àí1} ¬∑ e^{‚àíx/2}, &nbsp; x‚â•0<br/>
        CDF: F(x) = P(X¬≤‚â§x) = P(ŒΩ/2, x/2)  (regularized lower Œ≥)
      </div>
      <p class="mini muted">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì CDF ‡∏î‡πâ‡∏ß‡∏¢ incomplete gamma ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</p>
    </div>
  </section>

  <section class="card">
    <h3>3) ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç œá¬≤ üßÆ <span class="badge">Interactive</span></h3>
    <div class="calc-row" style="margin:.35rem 0 .5rem">
      <label for="df">df (ŒΩ):</label><input id="df" type="number" min="1" step="1" value="8">
      <label for="mode">‡πÇ‡∏´‡∏°‡∏î:</label>
      <select id="mode">
        <option value="left">P(œá¬≤ ‚â§ x)</option>
        <option value="right">P(œá¬≤ ‚â• x)</option>
        <option value="between">P(a ‚â§ œá¬≤ ‚â§ b)</option>
        <option value="density">f(x) (PDF) ‡∏ó‡∏µ‡πà x</option>
      </select>
      <span id="inputs-x" style="display:inline-flex;gap:.6rem;align-items:center">
        <label for="x">x:</label><input id="x" type="number" step="0.01" value="10.0" min="0">
      </span>
      <span id="inputs-ab" style="display:none;gap:.6rem;align-items:center">
        <label for="a">a:</label><input id="a" type="number" step="0.01" value="6.0" min="0">
        <label for="b">b:</label><input id="b" type="number" step="0.01" value="14.0" min="0">
      </span>
      <button class="btn" id="btn-calc">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
      <button class="btn secondary" id="btn-reset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      <span class="mini muted" id="status" aria-live="polite"></span>
    </div>

    <div class="grid2">
      <div>
        <table>
          <tbody>
            <tr><th style="width:40%">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th><td id="result">‚Äî</td></tr>
            <tr><th>PDF f(x)</th><td id="pdfout">‚Äî</td></tr>
            <tr><th>CDF F(x)=P(œá¬≤‚â§x)</th><td id="cdfout">‚Äî</td></tr>
          </tbody>
        </table>
        <div class="chipline">
          <span class="chip2">‡∏Ç‡∏ß‡∏≤‡πÄ‡∏ö‡πâ</span>
          <span class="chip2">df‚Üë ‚Üí ‡∏™‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</span>
          <span class="chip2">‡∏ä‡πà‡∏ß‡∏á x‚â•0</span>
        </div>
      </div>
      <div>
        <canvas id="chart" aria-label="‡∏Å‡∏£‡∏≤‡∏ü Chi-Square ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ï‡πâ‡πÇ‡∏Ñ‡πâ‡∏á"></canvas>
      </div>
    </div>
  </section>

  <section class="card">
    <h3>4) ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï œá¬≤* üìä <span class="badge">Interactive</span></h3>
    <div class="calc-row">
      <label for="df2">df:</label><input id="df2" type="number" min="1" step="1" value="8">
      <label for="alpha">Œ±:</label>
      <select id="alpha">
        <option>0.10</option><option selected>0.05</option><option>0.025</option>
        <option>0.01</option><option>0.005</option><option>0.001</option>
      </select>
      <button class="btn" id="btn-crit">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì œá¬≤*</button>
      <span class="mini muted" id="crit-status" aria-live="polite"></span>
    </div>
    <div class="grid2">
      <div>
        <table aria-label="‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏Ç‡∏ß‡∏≤‡∏´‡∏≤‡∏á">
          <thead><tr><th>Œ±</th><th>œá¬≤<sub>Œ±,ŒΩ</sub> (‡∏Ç‡∏ß‡∏≤)</th></tr></thead>
          <tbody id="right-tail"></tbody>
        </table>
      </div>
      <div>
        <table aria-label="‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CI ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô">
          <thead><tr><th>‡∏£‡∏∞‡∏î‡∏±‡∏ö (1‚àíŒ±)</th><th>‡∏ã‡πâ‡∏≤‡∏¢ œá¬≤<sub>Œ±/2,ŒΩ</sub></th><th>‡∏Ç‡∏ß‡∏≤ œá¬≤<sub>1‚àíŒ±/2,ŒΩ</sub></th></tr></thead>
          <tbody id="ci-tail"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="card grid2">
    <div>
      <h3>5) ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå (Workflow)</h3>
      <ol>
        <li class="step">‡∏Å‡∏≥‡∏´‡∏ô‡∏î df (‡πÄ‡∏ä‡πà‡∏ô one-sample variance: ŒΩ=n‚àí1)</li>
        <li class="step">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤/‡∏ä‡πà‡∏ß‡∏á)</li>
        <li class="step">‡πÉ‡∏ä‡πâ CDF ‡∏Ç‡∏≠‡∏á œá¬≤ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì p ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ inverse ‡∏´‡∏≤ œá¬≤* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö Œ±</li>
        <li class="step">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö p ‡∏Å‡∏±‡∏ö Œ± ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö x ‡∏Å‡∏±‡∏ö œá¬≤*</li>
      </ol>
    </div>
    <div>
      <h3>6) ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
      <p><strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> df=8, ‡∏´‡∏≤ P(œá¬≤ ‚â• 13.4)</p>
      <ol class="list-compact">
        <li>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì F(13.4) ‚Üí ‡πÑ‡∏î‡πâ ~0.900 (‡πÇ‡∏î‡∏¢ CDF)</li>
        <li>‡∏Ç‡∏ß‡∏≤‡∏´‡∏≤‡∏á: 1 ‚àí F(13.4) ‚âà 0.100</li>
      </ol>
      <p class="mini muted">‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô: ‡πÇ‡∏´‡∏°‡∏î P(œá¬≤‚â•x), df=8, x=13.4</p>
      <div class="toolbar" style="margin-top:.4rem">
        <a class="btn ghost" href="./normal.html">Normal</a>
        <a class="btn ghost" href="./t-distribution.html">t-Distribution</a>
        <a class="btn ghost" href="./z-score.html">Z-Score</a>
      </div>
    </div>
  </section>
</main>

<footer class="wrap" role="contentinfo" style="border-top:1px solid var(--border);margin-top:1rem;padding-top:.8rem">
  <div class="muted">¬© ‡∏Ñ‡∏≠‡∏£‡πå‡∏™‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡πÑ‡∏ó‡∏¢) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏î‡πâ‡∏ß‡∏¢ <code>print.css</code></div>
</footer>

<script>
  const fmt = (x, d=6) => Number.isFinite(x)
    ? (Math.round(x*10**d)/10**d).toFixed(d).replace(/\.?0+$/,'')
    : '‚Äî';
  const clamp = (v, lo, hi) => Math.max(lo, Math.min(hi, v));

  function lnGamma(z){
    const p=[676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-0.13857109526572012,9.9843695780195716e-6,1.5056327351493116e-7];
    let x=0.99999999999980993;
    for(let i=0;i<p.length;i++){ x += p[i]/(z+i+1); }
    const t = z + p.length - 0.5;
    return 0.5*Math.log(2*Math.PI) + (z+0.5)*Math.log(t) - t + Math.log(x) - Math.log(z);
  }
  const gamma = z => Math.exp(lnGamma(z));

  function gammaincP(s, x){
    if(x < 0 || s <= 0) return NaN;
    if(x === 0) return 0;

    if(x < s + 1){
      let sum = 1/s, term = 1/s, n = 1;
      let ap = s;
      while(n < 200){
        ap += 1;
        term *= x / ap;
        sum += term;
        if(Math.abs(term) < Math.abs(sum)*1e-12) break;
        n++;
      }
      return sum * Math.exp(-x + s*Math.log(x) - lnGamma(s));
    }

    let a0 = 0, b0 = 1, a1 = 1, b1 = x, fac = 1/a1;
    let gOld = a1/b1;
    for(let n=1;n<=500;n++){
      const an = n * (s - n);
      a0 = (a1 + a0*an);
      b0 = (b1 + b0*an);
      if(b0 !== 0){
        fac = 1/b0;
        a0 *= fac; b0 = 1; a1 *= fac; b1 *= fac;
      }
      const ap = (a0 + a1*(n + s));
      const bp = (b0 + b1*(n + s + x));
      a0 = a1; b0 = b1; a1 = ap; b1 = bp;
      if(b1 !== 0){
        const g = a1/b1;
        if(Math.abs(g - gOld) <= Math.abs(g)*1e-12){ gOld = g; break; }
        gOld = g;
      }
    }
    const Q = Math.exp(-x + s*Math.log(x) - lnGamma(s)) * gOld;
    return 1 - Q;
  }

  function chi2pdf(x, v){
    if(x < 0 || v <= 0) return 0;
    const k = v/2, c = 1/( Math.pow(2,k)*gamma(k) );
    return c * Math.pow(x, k-1) * Math.exp(-x/2);
  }
  function chi2cdf(x, v){
    if(x <= 0) return 0;
    const k = v/2;
    return gammaincP(k, x/2);
  }

  function chi2inv(p, v){
    if(!(p>0 && p<1) || v<=0) return NaN;
    let lo = 0, hi = v + 20*Math.sqrt(2*v) + 50;
    for(let i=0;i<100;i++){
      const mid = (lo+hi)/2, F = chi2cdf(mid, v);
      if(F < p) lo = mid; else hi = mid;
    }
    return (lo+hi)/2;
  }

  const dfEl = document.getElementById('df');
  const modeEl = document.getElementById('mode');
  const xEl = document.getElementById('x');
  const aEl = document.getElementById('a');
  const bEl = document.getElementById('b');
  const inputsX = document.getElementById('inputs-x');
  const inputsAB = document.getElementById('inputs-ab');

  const btnCalc = document.getElementById('btn-calc');
  const btnReset = document.getElementById('btn-reset');
  const statusEl = document.getElementById('status');
  const resultEl = document.getElementById('result');
  const pdfEl = document.getElementById('pdfout');
  const cdfEl = document.getElementById('cdfout');

  const canvas = document.getElementById('chart');
  const ctx = canvas.getContext('2d');

  function updateModeUI(){
    const md = modeEl.value;
    inputsX.style.display = (md==='between') ? 'none' : 'inline-flex';
    inputsAB.style.display = (md==='between') ? 'inline-flex' : 'none';
  }

  function drawChi2(v, shadeMode, val1, val2){
    const W = ctx.canvas.width, H = ctx.canvas.height;
    ctx.clearRect(0,0,W,H);

    ctx.globalAlpha = 0.25; ctx.strokeStyle = '#223049';
    for(let i=1;i<=4;i++){ const y=H-(H*i/5); ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
    ctx.globalAlpha = 1;

    const m = Math.max(v-2 + 5*Math.sqrt(2*v), v + 6*Math.sqrt(2*v));
    const xmin = 0, xmax = Math.max(8, m);
    const ymax = chi2pdf(Math.max(1e-6, Math.max(0, v-2)), v);

    const mapX = x => ((x - xmin)/(xmax - xmin))*(W-20)+10;
    const mapY = y => H - y * (H*0.9/Math.max(1e-12, ymax));

    ctx.beginPath();
    let first = true;
    const steps = 500;
    for(let i=0;i<=steps;i++){
      const x = xmin + (xmax-xmin)*i/steps;
      const y = chi2pdf(x, v);
      const X = mapX(x), Y = mapY(y);
      if(first){ ctx.moveTo(X,Y); first=false; } else ctx.lineTo(X,Y);
    }
    ctx.strokeStyle = '#6ea8ff'; ctx.lineWidth=2; ctx.stroke();

    ctx.fillStyle = 'rgba(110,168,255,0.35)';
    if(shadeMode==='left' || shadeMode==='right'){
      const x = Math.max(0, val1);
      const a = shadeMode==='left' ? xmin : x;
      const b = shadeMode==='left' ? x    : xmax;
      ctx.beginPath();
      for(let i=0;i<=steps;i++){
        const xx = a + (b-a)*i/steps;
        const yy = chi2pdf(xx, v);
        const X = mapX(xx), Y = mapY(yy);
        if(i===0) ctx.moveTo(X,H);
        ctx.lineTo(X,Y);
      }
      ctx.lineTo(mapX(b),H); ctx.closePath(); ctx.fill();
    } else if(shadeMode==='between'){
      const a = Math.max(0, Math.min(val1, val2)), b = Math.max(0, Math.max(val1, val2));
      ctx.beginPath();
      for(let i=0;i<=steps;i++){
        const xx = a + (b-a)*i/steps;
        const yy = chi2pdf(xx, v);
        const X = mapX(xx), Y = mapY(yy);
        if(i===0) ctx.moveTo(X,H);
        ctx.lineTo(X,Y);
      }
      ctx.lineTo(mapX(b),H); ctx.closePath(); ctx.fill();
    }
  }

  function compute(){
    const v = Math.max(1, Math.round(Number(dfEl.value)||8));
    dfEl.value = v;
    const md = modeEl.value;
    statusEl.textContent='';

    let out='‚Äî', pdf='‚Äî', cdf='‚Äî';

    if(md==='left' || md==='right' || md==='density'){
      const x = Math.max(0, Number(xEl.value)||0);
      xEl.value = x;
      const f = chi2pdf(x, v);
      const F = chi2cdf(x, v);
      pdf = fmt(f,6);
      cdf = fmt(F,6);

      if(md==='left'){
        out = `P(œá¬≤ ‚â§ ${x}) = ${fmt(F,6)}`;
        drawChi2(v, 'left', x);
      } else if(md==='right'){
        const p = 1 - F;
        out = `P(œá¬≤ ‚â• ${x}) = ${fmt(p,6)}`;
        drawChi2(v, 'right', x);
      } else {
        out = `f(${x}) = ${fmt(f,6)}`;
        drawChi2(v, null, null);
      }
    } else if(md==='between'){
      const a = Math.max(0, Number(aEl.value)||0);
      const b = Math.max(0, Number(bEl.value)||0);
      aEl.value = a; bEl.value = b;
      const lo = Math.min(a,b), hi = Math.max(a,b);
      const Fa = chi2cdf(lo, v), Fb = chi2cdf(hi, v);
      const p = Math.max(0, Fb - Fa);
      out = `P(${lo} ‚â§ œá¬≤ ‚â§ ${hi}) = ${fmt(p,6)}`;
      pdf = '‚Äî'; cdf = `F(hi)‚àíF(lo) = ${fmt(Fb,6)} ‚àí ${fmt(Fa,6)} = ${fmt(p,6)}`;
      drawChi2(v, 'between', lo, hi);
    }

    resultEl.textContent = out;
    pdfEl.textContent = pdf;
    cdfEl.textContent = cdf;
    statusEl.textContent = statusEl.textContent || `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï df=${v}`;
  }

  modeEl.addEventListener('change', ()=>{ updateModeUI(); compute(); });
  btnCalc.addEventListener('click', compute);
  btnReset.addEventListener('click', ()=>{
    dfEl.value = 8; modeEl.value='left';
    xEl.value = 10.0; aEl.value = 6.0; bEl.value = 14.0;
    updateModeUI(); compute();
  });
  window.addEventListener('resize', compute);

  document.getElementById('btn-save-png').addEventListener('click', ()=>{
    compute();
    const url = canvas.toDataURL('image/png');
    const a = document.createElement('a');
    const stamp = new Date().toISOString().replace(/[:.]/g,'-');
    a.href = url; a.download = `chi-square-plot-${stamp}.png`; a.click();
  });

  const df2El = document.getElementById('df2');
  const btnCrit = document.getElementById('btn-crit');
  const rightTail = document.getElementById('right-tail');
  const ciTail = document.getElementById('ci-tail');
  const critStatus = document.getElementById('crit-status');

  function buildCritical(){
    const v = Math.max(1, Math.round(Number(df2El.value)||8));
    df2El.value = v;
    const alphas = [0.10,0.05,0.025,0.01,0.005,0.001];

    rightTail.innerHTML = '';
    ciTail.innerHTML = '';

    alphas.forEach(a=>{
      const xcrit = chi2inv(1-a, v);
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${a}</td><td>${fmt(xcrit,4)}</td>`;
      rightTail.appendChild(tr);
    });

    const levels = [0.90,0.95,0.99];
    levels.forEach(L=>{
      const a = 1 - L;
      const left = chi2inv(a/2, v);
      const right = chi2inv(1 - a/2, v);
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${(L*100).toFixed(0)}%</td><td>${fmt(left,4)}</td><td>${fmt(right,4)}</td>`;
      ciTail.appendChild(tr);
    });

    critStatus.textContent = `‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö df=${v}`;
  }

  btnCrit.addEventListener('click', buildCritical);

  const cards = document.querySelectorAll('.card');
  const obs = new IntersectionObserver((ents)=>{
    ents.forEach(e=>{
      if(e.isIntersecting){
        e.target.animate([{opacity:0, transform:'translateY(8px)'},{opacity:1, transform:'translateY(0)'}],
          {duration:450, easing:'ease-out', fill:'forwards'});
        obs.unobserve(e.target);
      }
    });
  }, {threshold:.12});
  cards.forEach(c=>obs.observe(c));

  function init(){ updateModeUI(); compute(); buildCritical(); }
  init();
</script>
</body>
</html>
