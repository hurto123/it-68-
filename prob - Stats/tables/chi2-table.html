<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Interactive χ² Table</title>
  <link rel="stylesheet" href="../styles/tokens.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/light.css">
  <link rel="stylesheet" href="../styles/typography-access.css">
  <script defer src="../app.js"></script>
  <style>
    main { display: grid; gap: 1.5rem; }
    .controls { display: grid; gap: 0.75rem; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
    .table-wrapper { max-height: 480px; overflow: auto; border-radius: 1rem; border: 1px solid rgba(148,163,184,0.35); }
    table { border-collapse: collapse; width: 100%; min-width: 680px; }
    th, td { padding: 0.45rem 0.6rem; border: 1px solid rgba(148,163,184,0.25); text-align: center; font-variant-numeric: tabular-nums; }
    thead th { position: sticky; top: 0; background: var(--surface,#fff); }
    tbody th { position: sticky; left: 0; background: var(--surface,#fff); }
    [data-highlight="true"] { background: rgba(250,204,21,0.3); font-weight: 600; }
  </style>
</head>
<body data-page="table">
  <header class="site-header">
    <div>
      <p class="eyebrow">Table</p>
      <h1>ตารางค่า χ² (พื้นที่ขวา)</h1>
      <p class="tagline">ใช้สำหรับ goodness-of-fit และ independence test</p>
    </div>
    <nav class="header-actions">
      <a class="ghost" href="../index.html#resources">กลับ</a>
    </nav>
  </header>
  <main class="card">
    <section class="controls">
      <label>df
        <input id="chi-df" type="number" min="1" step="1" value="6">
      </label>
      <label>พื้นที่ขวา (α)
        <input id="chi-alpha" type="number" step="0.0001" value="0.05">
      </label>
      <button class="ghost" id="chi-copy">คัดลอกค่า</button>
    </section>
    <p id="chi-summary" class="tagline"></p>
    <div class="table-wrapper">
      <table id="chi-table"></table>
    </div>
  </main>
  <script type="module">
    import { chiSquareInv } from '../tools/distributions.js';

    const dfList = [...Array.from({ length: 30 }, (_, i) => i + 1), 40, 60, 80, 100];
    const alphaList = [0.995, 0.99, 0.975, 0.95, 0.90, 0.10, 0.05, 0.025, 0.01, 0.005];

    const table = document.getElementById('chi-table');
    const dfInput = document.getElementById('chi-df');
    const alphaInput = document.getElementById('chi-alpha');
    const summary = document.getElementById('chi-summary');
    const copyBtn = document.getElementById('chi-copy');

    function buildTable() {
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = '<th>df</th>' + alphaList.map(a => `<th>α=${a}</th>`).join('');
      thead.appendChild(headerRow);
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      dfList.forEach(df => {
        const row = document.createElement('tr');
        row.innerHTML = `<th>${df}</th>`;
        alphaList.forEach(alpha => {
          const cell = document.createElement('td');
          const value = chiSquareInv(1 - alpha, df);
          cell.dataset.df = String(df);
          cell.dataset.alpha = String(alpha);
          cell.textContent = value.toFixed(3);
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
      table.appendChild(tbody);
    }

    function highlight(df, alpha) {
      table.querySelectorAll('[data-highlight="true"]').forEach(el => el.removeAttribute('data-highlight'));
      const dfNearest = dfList.reduce((prev, curr) => Math.abs(curr - df) < Math.abs(prev - df) ? curr : prev, dfList[0]);
      const alphaNearest = alphaList.reduce((prev, curr) => Math.abs(curr - alpha) < Math.abs(prev - alpha) ? curr : prev, alphaList[0]);
      const cell = table.querySelector(`td[data-df="${dfNearest}"][data-alpha="${alphaNearest}"]`);
      if (cell) cell.setAttribute('data-highlight', 'true');
      const value = chiSquareInv(1 - alpha, df);
      summary.innerHTML = `<code>χ²<sub>df=${df.toFixed(0)}, α=${alpha.toFixed(4)}</sub> ≈ ${value.toFixed(3)}</code>`;
      copyBtn.dataset.value = value.toFixed(5);
    }

    function update() {
      const df = Math.max(1, Number(dfInput.value));
      const alpha = Math.min(0.99, Math.max(0.0001, Number(alphaInput.value)));
      highlight(df, alpha);
    }

    dfInput.addEventListener('input', update);
    alphaInput.addEventListener('input', update);

    copyBtn.addEventListener('click', () => {
      const value = copyBtn.dataset.value;
      if (!value) return;
      navigator.clipboard?.writeText(value);
      copyBtn.textContent = 'คัดลอกแล้ว!';
      setTimeout(() => { copyBtn.textContent = 'คัดลอกค่า'; }, 2000);
    });

    buildTable();
    update();
  </script>
</body>
</html>
