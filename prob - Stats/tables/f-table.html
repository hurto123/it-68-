<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Interactive F Table</title>
  <link rel="stylesheet" href="../styles/tokens.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/light.css">
  <link rel="stylesheet" href="../styles/typography-access.css">
  <script defer src="../app.js"></script>
  <style>
    main { display: grid; gap: 1.5rem; }
    .controls { display: grid; gap: 0.75rem; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    .table-wrapper { max-height: 480px; overflow: auto; border-radius: 1rem; border: 1px solid rgba(148,163,184,0.35); }
    table { border-collapse: collapse; width: 100%; min-width: 680px; }
    th, td { padding: 0.45rem 0.6rem; border: 1px solid rgba(148,163,184,0.25); text-align: center; font-variant-numeric: tabular-nums; }
    thead th { position: sticky; top: 0; background: var(--surface,#fff); }
    tbody th { position: sticky; left: 0; background: var(--surface,#fff); }
    [data-highlight="true"] { background: rgba(96,165,250,0.3); font-weight: 600; }
  </style>
</head>
<body data-page="table">
  <header class="site-header">
    <div>
      <p class="eyebrow">Table</p>
      <h1>ตารางค่า F (พื้นที่ขวา)</h1>
      <p class="tagline">สำหรับ ANOVA และการเปรียบเทียบความแปรปรวน</p>
    </div>
    <nav class="header-actions">
      <a class="ghost" href="../index.html#resources">กลับ</a>
    </nav>
  </header>
  <main class="card">
    <section class="controls">
      <label>df₁ (numerator)
        <input id="f-df1" type="number" min="1" step="1" value="4">
      </label>
      <label>df₂ (denominator)
        <input id="f-df2" type="number" min="1" step="1" value="20">
      </label>
      <label>α (พื้นที่ขวา)
        <select id="f-alpha">
          <option value="0.10">0.10</option>
          <option value="0.05" selected>0.05</option>
          <option value="0.025">0.025</option>
          <option value="0.01">0.01</option>
        </select>
      </label>
      <button class="ghost" id="f-copy">คัดลอกค่า</button>
    </section>
    <p id="f-summary" class="tagline"></p>
    <div class="table-wrapper">
      <table id="f-table"></table>
    </div>
  </main>
  <script type="module">
    import { fInv } from '../tools/distributions.js';

    const df1List = [...Array.from({ length: 10 }, (_, i) => i + 1), 12, 15, 20, 30];
    const df2List = [...Array.from({ length: 10 }, (_, i) => i + 1), 12, 15, 20, 24, 30, 40, 60, 120];

    const table = document.getElementById('f-table');
    const df1Input = document.getElementById('f-df1');
    const df2Input = document.getElementById('f-df2');
    const alphaSelect = document.getElementById('f-alpha');
    const summary = document.getElementById('f-summary');
    const copyBtn = document.getElementById('f-copy');

    function buildTable(alpha) {
      table.innerHTML = '';
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      headerRow.innerHTML = '<th>df₂ \ df₁</th>' + df1List.map(df1 => `<th>${df1}</th>`).join('');
      thead.appendChild(headerRow);
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      df2List.forEach(df2 => {
        const row = document.createElement('tr');
        row.innerHTML = `<th>${df2}</th>`;
        df1List.forEach(df1 => {
          const cell = document.createElement('td');
          const value = fInv(1 - Number(alpha), df1, df2);
          cell.dataset.df1 = String(df1);
          cell.dataset.df2 = String(df2);
          cell.textContent = value.toFixed(3);
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
      table.appendChild(tbody);
    }

    function highlight(df1, df2, alpha) {
      table.querySelectorAll('[data-highlight="true"]').forEach(el => el.removeAttribute('data-highlight'));
      const df1Nearest = df1List.reduce((prev, curr) => Math.abs(curr - df1) < Math.abs(prev - df1) ? curr : prev, df1List[0]);
      const df2Nearest = df2List.reduce((prev, curr) => Math.abs(curr - df2) < Math.abs(prev - df2) ? curr : prev, df2List[0]);
      const cell = table.querySelector(`td[data-df1="${df1Nearest}"][data-df2="${df2Nearest}"]`);
      if (cell) cell.setAttribute('data-highlight', 'true');
      const value = fInv(1 - alpha, df1, df2);
      summary.innerHTML = `<code>F<sub>${df1},${df2}</sub>(α=${alpha}) ≈ ${value.toFixed(3)}</code>`;
      copyBtn.dataset.value = value.toFixed(5);
    }

    function update() {
      const df1 = Math.max(1, Number(df1Input.value));
      const df2 = Math.max(1, Number(df2Input.value));
      const alpha = Number(alphaSelect.value);
      buildTable(alpha);
      highlight(df1, df2, alpha);
    }

    df1Input.addEventListener('input', update);
    df2Input.addEventListener('input', update);
    alphaSelect.addEventListener('change', update);

    copyBtn.addEventListener('click', () => {
      const value = copyBtn.dataset.value;
      if (!value) return;
      navigator.clipboard?.writeText(value);
      copyBtn.textContent = 'คัดลอกแล้ว!';
      setTimeout(() => { copyBtn.textContent = 'คัดลอกค่า'; }, 2000);
    });

    update();
  </script>
</body>
</html>
