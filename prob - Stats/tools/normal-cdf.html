<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Normal CDF Calculator</title>
  <link rel="stylesheet" href="../styles/tokens.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/light.css">
  <link rel="stylesheet" href="../styles/typography-access.css">
  <link rel="stylesheet" href="../styles/print.css" media="print">
  <script defer src="../app.js"></script>
  <script defer src="../i18n/i18n.js"></script>
  <style>
    .grid-two { display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    fieldset { border: 1px solid rgba(148,163,184,0.35); border-radius: 0.75rem; padding: 0.75rem 1rem; margin-top: 0.75rem; }
    fieldset legend { font-weight: 600; }
    .result-block { margin-top: 0.75rem; background: rgba(251, 191, 36, 0.15); border-radius: 0.75rem; padding: 1rem; }
    .result-block p { margin: 0.25rem 0; }
    output[data-error] { color: #b91c1c; }
  </style>
</head>
<body data-page="tool">
  <header class="site-header">
    <div>
      <p class="eyebrow">Calculator</p>
      <h1>Normal distribution (μ, σ)</h1>
      <p class="tagline">คำนวณความน่าจะเป็นและค่าควอนไทล์สำหรับการแจกแจงปกติทั่วไป</p>
    </div>
    <nav class="header-actions">
      <a class="ghost" href="../index.html#tools">กลับเครื่องมือ</a>
      <button id="reset" class="ghost">ค่าเริ่มต้น</button>
      <button id="print-current" class="ghost">พิมพ์</button>
    </nav>
  </header>
  <main class="card-grid">
    <article class="card">
      <h2>พื้นที่ใต้โค้ง</h2>
      <div class="grid-two">
        <label>ค่า x
          <input id="norm-x" type="number" step="0.01" value="75">
        </label>
        <label>μ (ค่าเฉลี่ย)
          <input id="norm-mean" type="number" step="0.01" value="70">
        </label>
        <label>σ (ส่วนเบี่ยงเบนมาตรฐาน)
          <input id="norm-sd" type="number" step="0.01" value="8">
        </label>
      </div>
      <fieldset>
        <legend>พื้นที่ที่ต้องการ</legend>
        <label><input type="radio" name="norm-tail" value="left" checked> P(X ≤ x)</label>
        <label><input type="radio" name="norm-tail" value="right"> P(X ≥ x)</label>
        <label><input type="radio" name="norm-tail" value="between"> ระหว่างค่า x สองค่า</label>
      </fieldset>
      <div class="grid-two" data-extra="between" hidden>
        <label>ค่า x ขวา
          <input id="norm-x2" type="number" step="0.01" value="85">
        </label>
      </div>
      <button class="primary" id="norm-calc">คำนวณพื้นที่</button>
      <output id="norm-result" class="result-block"></output>
    </article>

    <article class="card">
      <h2>หา quantile จากพื้นที่</h2>
      <div class="grid-two">
        <label>μ
          <input id="norm-mean-inv" type="number" step="0.01" value="70">
        </label>
        <label>σ
          <input id="norm-sd-inv" type="number" step="0.01" value="8">
        </label>
        <label>พื้นที่ซ้าย (0-1)
          <input id="norm-p" type="number" step="0.0001" value="0.95">
        </label>
      </div>
      <button class="primary" id="norm-inv">หา x</button>
      <output id="norm-inv-result" class="result-block"></output>
    </article>

    <article class="card">
      <h2>คำแนะนำเพิ่มเติม</h2>
      <ul>
        <li>อย่าลืมตรวจสอบหน่วยของ σ และค่า x ว่าอยู่ในหน่วยเดียวกัน</li>
        <li>สามารถเทียบกับค่า z ได้โดยการแปลง (x − μ) / σ</li>
        <li>ดูบทอธิบายเพิ่มเติมใน <a href="../content/11-continuous-normal.html">บท 11</a> หรือ <a href="../tables/z-table.html">ตาราง Z</a></li>
      </ul>
    </article>
  </main>
  <footer class="site-footer">
    <p>© 2024 Stats Learning Lab</p>
  </footer>
  <script type="module">
    import { normCdf, normInv } from './distributions.js';

    const xInput = document.getElementById('norm-x');
    const meanInput = document.getElementById('norm-mean');
    const sdInput = document.getElementById('norm-sd');
    const tailRadios = document.querySelectorAll('input[name="norm-tail"]');
    const betweenGroup = document.querySelector('[data-extra="between"]');
    const x2Input = document.getElementById('norm-x2');
    const resultOutput = document.getElementById('norm-result');
    const meanInvInput = document.getElementById('norm-mean-inv');
    const sdInvInput = document.getElementById('norm-sd-inv');
    const pInput = document.getElementById('norm-p');
    const invOutput = document.getElementById('norm-inv-result');

    function showError(target, message) {
      target.innerHTML = `<p data-error>${message}</p>`;
    }

    function toggleBetween() {
      const mode = document.querySelector('input[name="norm-tail"]:checked')?.value;
      betweenGroup?.toggleAttribute('hidden', mode !== 'between');
    }

    tailRadios.forEach(radio => radio.addEventListener('change', toggleBetween));
    toggleBetween();

    document.getElementById('norm-calc')?.addEventListener('click', () => {
      try {
        const x = Number(xInput.value);
        const mean = Number(meanInput.value);
        const sd = Number(sdInput.value);
        if (!Number.isFinite(sd) || sd <= 0) throw new Error('σ ต้องมากกว่า 0');
        const mode = document.querySelector('input[name="norm-tail"]:checked')?.value ?? 'left';
        if (mode === 'between') {
          const x2 = Number(x2Input.value);
          if (!Number.isFinite(x2)) throw new Error('กรุณากรอกค่าด้านขวา');
          const lower = Math.min(x, x2);
          const upper = Math.max(x, x2);
          const prob = Math.max(0, normCdf(upper, mean, sd) - normCdf(lower, mean, sd));
          resultOutput.innerHTML = `<p>P(${lower.toFixed(2)} ≤ X ≤ ${upper.toFixed(2)}) = ${prob.toFixed(4)}</p><p class="tagline">ช่วงความน่าจะเป็นระหว่างสองค่า</p>`;
        } else if (mode === 'left') {
          const prob = normCdf(x, mean, sd);
          resultOutput.innerHTML = `<p>P(X ≤ ${x.toFixed(2)}) = ${prob.toFixed(4)}</p><p class="tagline">ใช้ตรวจสอบ percentile</p>`;
        } else {
          const prob = 1 - normCdf(x, mean, sd);
          resultOutput.innerHTML = `<p>P(X ≥ ${x.toFixed(2)}) = ${prob.toFixed(4)}</p><p class="tagline">ตีความเป็น tail probability</p>`;
        }
      } catch (error) {
        showError(resultOutput, error.message);
      }
    });

    document.getElementById('norm-inv')?.addEventListener('click', () => {
      try {
        const mean = Number(meanInvInput.value);
        const sd = Number(sdInvInput.value);
        if (!Number.isFinite(sd) || sd <= 0) throw new Error('σ ต้องมากกว่า 0');
        const p = Number(pInput.value);
        if (!Number.isFinite(p) || p <= 0 || p >= 1) throw new Error('พื้นที่ต้องอยู่ในช่วง (0,1)');
        const z = normInv(p);
        const x = mean + z * sd;
        invOutput.innerHTML = `<p>x = ${x.toFixed(4)} (z = ${z.toFixed(4)})</p>`;
      } catch (error) {
        showError(invOutput, error.message);
      }
    });

    document.getElementById('reset')?.addEventListener('click', () => {
      xInput.value = '75';
      meanInput.value = '70';
      sdInput.value = '8';
      x2Input.value = '85';
      meanInvInput.value = '70';
      sdInvInput.value = '8';
      pInput.value = '0.95';
      document.querySelector('input[name="norm-tail"][value="left"]').checked = true;
      toggleBetween();
      resultOutput.innerHTML = '';
      invOutput.innerHTML = '';
    });
  </script>
</body>
</html>
