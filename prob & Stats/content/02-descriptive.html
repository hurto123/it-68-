<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>บทที่ 2: หลักการนับเบื้องต้น</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    :root {
      color-scheme: light dark;
    }
    body.page {
      background: radial-gradient(circle at top, rgba(255,255,255,0.9), rgba(240,240,255,0.95));
      min-height: 100vh;
    }
    header.hero {
      padding: 2.5rem 1rem 1.5rem;
      background: linear-gradient(120deg, #512da8, #9575cd);
      color: #fff;
      border-radius: 24px;
      box-shadow: 0 20px 40px rgba(81,45,168,0.25);
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }
    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.35), transparent 65%),
                  radial-gradient(circle at 80% 0%, rgba(255,255,255,0.25), transparent 55%);
      pointer-events: none;
    }
    header.hero h1 {
      font-size: clamp(2.4rem, 3vw + 1rem, 3.4rem);
      margin-bottom: 0.4rem;
    }
    header.hero p {
      font-size: 1.1rem;
      max-width: 60ch;
    }
    section.card {
      background: rgba(255,255,255,0.85);
      border-radius: 20px;
      padding: 2rem clamp(1rem, 5vw, 3rem);
      margin-bottom: 2rem;
      box-shadow: 0 12px 32px rgba(33, 33, 52, 0.1);
      backdrop-filter: blur(6px);
    }
    .columns {
      display: grid;
      gap: 1.5rem;
    }
    @media (min-width: 880px) {
      .columns.two {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
      .columns.three {
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }
    h2 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.8rem;
    }
    h2 span.badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #ede7f6;
      color: #4527a0;
      border-radius: 999px;
      padding: 0.1rem 0.9rem;
      font-size: 1rem;
      font-weight: 600;
    }
    .highlight {
      padding: 1.2rem 1.4rem;
      border-left: 6px solid #7e57c2;
      background: rgba(126, 87, 194, 0.08);
      border-radius: 12px;
      margin-top: 1rem;
    }
    details.lesson-toggle {
      border: 1px solid rgba(81,45,168,0.2);
      border-radius: 14px;
      padding: 1rem 1.4rem;
      background: rgba(81,45,168,0.05);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.3);
    }
    details.lesson-toggle summary {
      cursor: pointer;
      font-weight: 600;
    }
    .definition-card {
      border-radius: 16px;
      background: linear-gradient(160deg, rgba(197, 202, 233, 0.45), rgba(232, 234, 246, 0.6));
      padding: 1.4rem;
      display: grid;
      gap: 0.6rem;
      border: 1px solid rgba(82, 82, 122, 0.12);
    }
    .definition-card strong {
      font-size: 1.05rem;
    }
    .code-box {
      background: #1e1e2f;
      color: #f9f5ff;
      padding: 1.2rem 1.4rem;
      border-radius: 12px;
      font-family: "Fira Code", "SFMono-Regular", "Consolas", monospace;
      font-size: 0.95rem;
      line-height: 1.5;
      overflow-x: auto;
    }
    .table-wrapper {
      overflow-x: auto;
      border-radius: 14px;
      border: 1px solid rgba(81,45,168,0.15);
      background: rgba(255,255,255,0.92);
    }
    table.styled {
      width: 100%;
      border-collapse: collapse;
    }
    table.styled th,
    table.styled td {
      padding: 0.9rem 1.2rem;
      text-align: left;
    }
    table.styled thead {
      background: rgba(81,45,168,0.12);
      color: #311b92;
    }
    table.styled tbody tr:nth-child(even) {
      background: rgba(81,45,168,0.04);
    }
    .calculator {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }
    .calculator label {
      font-weight: 600;
    }
    .calculator input {
      border-radius: 12px;
      border: 1px solid rgba(81,45,168,0.3);
      padding: 0.6rem 0.9rem;
      font-size: 1rem;
    }
    .calculator button {
      border: none;
      border-radius: 999px;
      padding: 0.7rem 1.5rem;
      background: linear-gradient(120deg, #5e35b1, #7e57c2);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .calculator button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(94,53,177,0.25);
    }
    .result-card {
      margin-top: 0.6rem;
      padding: 1rem 1.2rem;
      border-radius: 12px;
      background: rgba(76,175,80,0.1);
      color: #1b5e20;
      font-weight: 600;
    }
    canvas {
      max-width: 100%;
    }
    .note {
      font-size: 0.95rem;
      color: #4a4a6a;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
  <main class="container">
    <header class="hero">
      <h1>บทเรียนที่ 2: หลักการนับเบื้องต้น (Counting Principles)</h1>
      <p>เตรียมพร้อมก้าวสู่โลกของความน่าจะเป็นด้วยศิลปะแห่งการนับจำนวนวิธีที่เป็นไปได้อย่างเป็นระบบ ทั้งกฎการบวก การคูณ ไปจนถึงเครื่องมือขั้นสูงอย่าง Permutation และ Combination</p>
    </header>

    <section class="card" id="why-counting">
      <h2><span class="badge">Step 1</span> ทำไมต้องเรียน “นับเลข”?</h2>
      <p>ถึงแม้ทุกคนจะคุ้นเคยกับการนับตัวเลขตั้งแต่เด็ก แต่ในทางสถิติ “การนับ” คือการประเมินจำนวนวิธีทั้งหมดที่เป็นไปได้ของเหตุการณ์ที่ซับซ้อน เช่น การจัดตู้เสื้อผ้า การเลือกคณะกรรมการ หรือการสร้างรหัสผ่าน ซึ่งเป็นพื้นฐานสำคัญก่อนเข้าสู่การคำนวณความน่าจะเป็น</p>
      <div class="highlight">
        <strong>สถานการณ์ตัวอย่าง</strong>
        <ul>
          <li>มีเสื้อ 3 ตัว กางเกง 2 ตัว จะแต่งตัวได้ทั้งหมดกี่แบบ?</li>
          <li>มีคน 10 คน จะเลือกกรรมการ 3 คนได้กี่วิธี?</li>
          <li>จะสร้างรหัส ATM 4 หลักได้ทั้งหมดกี่รหัส?</li>
        </ul>
        <p>การนับแบบดั้งเดิมอาจช้าและผิดพลาดง่าย หลักการนับจึงช่วยให้เรามองภาพรวมและแก้ปัญหาอย่างเป็นขั้นตอน</p>
      </div>
    </section>

    <section class="card" id="basic-rules">
      <h2><span class="badge">Step 2</span> กฎพื้นฐาน: Addition &amp; Multiplication</h2>
      <div class="columns two">
        <article class="definition-card">
          <strong>กฎการบวก (Addition Rule)</strong>
          <p><em>ใช้เมื่อมีหลายทางเลือกที่เป็นไปได้อย่างใดอย่างหนึ่ง</em> หากแต่ละทางเลือกเป็นอิสระและไม่สามารถเกิดพร้อมกันได้ เรานับจำนวนวิธีของแต่ละทางเลือกแล้วบวกกัน</p>
          <p class="note">คีย์เวิร์ด: “หรือ”, “อย่างใดอย่างหนึ่ง”</p>
          <details class="lesson-toggle">
            <summary>ตัวอย่าง: เมนูเครื่องดื่ม</summary>
            <p>ร้านน้ำมีเมนูปั่น 4 แบบ และเมนูร้อน 3 แบบ ลูกค้าสามารถเลือกอย่างใดอย่างหนึ่งได้ทั้งหมด <strong>4 + 3 = 7 วิธี</strong></p>
          </details>
        </article>
        <article class="definition-card">
          <strong>กฎการคูณ (Multiplication Rule)</strong>
          <p><em>ใช้เมื่อการทำงานประกอบด้วยหลายขั้นตอนที่ต้องทำต่อเนื่องกัน</em> นับจำนวนวิธีของแต่ละขั้นตอนแล้วยกผลคูณเพื่อหาจำนวนวิธีทั้งหมด</p>
          <p class="note">คีย์เวิร์ด: “และ”, “ทำตามลำดับ”, “ต่อเนื่องกัน”</p>
          <details class="lesson-toggle">
            <summary>ตัวอย่าง: แต่งกาย</summary>
            <p>เลือกเสื้อ 3 แบบ และเลือกกางเกง 4 แบบได้ <strong>3 × 4 = 12 วิธี</strong></p>
          </details>
        </article>
      </div>

      <div class="highlight">
        <h3>ตัวอย่างกฎการคูณแบบโต้ตอบ</h3>
        <p>ทดลองเปลี่ยนจำนวนเสื้อผ้าเพื่อดูจำนวนชุดแต่งกายที่เป็นไปได้!</p>
        <div class="calculator" id="outfit-calculator">
          <label>จำนวนเสื้อที่มี
            <input type="number" id="shirts" value="3" min="0" />
          </label>
          <label>จำนวนกางเกงที่มี
            <input type="number" id="pants" value="4" min="0" />
          </label>
          <button type="button" id="calcOutfit">คำนวณจำนวนชุดที่เป็นไปได้</button>
          <p class="result-card" id="outfitResult">มีทั้งหมด 12 วิธีในการแต่งตัว</p>
        </div>
      </div>
    </section>

    <section class="card" id="advanced-tools">
      <h2><span class="badge">Step 3</span> เครื่องมือขั้นสูง: Permutation &amp; Combination</h2>
      <p>เมื่อจำนวนทางเลือกมากขึ้น เราใช้เครื่องมือที่ทรงพลังขึ้นเพื่อจัดการกับการเรียงลำดับและการจัดกลุ่มอย่างเป็นระบบ</p>

      <div class="columns two">
        <article class="definition-card">
          <strong>Permutation (การเรียงสับเปลี่ยน)</strong>
          <p>นำของที่แตกต่างกันทั้งหมด <code>n</code> ชิ้น มาเรียงลำดับเพียง <code>r</code> ชิ้น โดยลำดับมีความสำคัญ</p>
          <div class="code-box">
P<sub>n,r</sub> = \(\dfrac{n!}{(n-r)!}\)
          </div>
          <p class="note">หัวใจสำคัญ: การสลับตำแหน่งถือว่าเป็นอีกหนึ่งวิธี</p>
        </article>
        <article class="definition-card">
          <strong>Combination (การจัดหมู่)</strong>
          <p>เลือกของที่แตกต่างกันทั้งหมด <code>n</code> ชิ้น มาเป็นกลุ่มจำนวน <code>r</code> ชิ้น โดยไม่สนใจลำดับ</p>
          <div class="code-box">
C<sub>n,r</sub> = \(\binom{n}{r} = \dfrac{n!}{r!(n-r)!}\)
          </div>
          <p class="note">หัวใจสำคัญ: ได้ของครบตามจำนวนก็พอ ใครมาก่อนไม่สำคัญ</p>
        </article>
      </div>

      <div class="columns two" id="pc-calculators">
        <div>
          <h3>คำนวณ Permutation</h3>
          <div class="calculator">
            <label>จำนวนทั้งหมด (n)
              <input type="number" id="perm-n" value="8" min="0" />
            </label>
            <label>จำนวนที่เรียง (r)
              <input type="number" id="perm-r" value="3" min="0" />
            </label>
            <button type="button" id="calcPerm">คำนวณ P<sub>n,r</sub></button>
            <div class="result-card" id="permResult">P<sub>8,3</sub> = 336 วิธี</div>
          </div>
        </div>
        <div>
          <h3>คำนวณ Combination</h3>
          <div class="calculator">
            <label>จำนวนทั้งหมด (n)
              <input type="number" id="comb-n" value="10" min="0" />
            </label>
            <label>จำนวนที่เลือก (r)
              <input type="number" id="comb-r" value="3" min="0" />
            </label>
            <button type="button" id="calcComb">คำนวณ C<sub>n,r</sub></button>
            <div class="result-card" id="combResult">C<sub>10,3</sub> = 120 วิธี</div>
          </div>
        </div>
      </div>

      <div class="card" style="background: rgba(255,255,255,0.6); margin-top: 2rem;">
        <h3>กราฟเปรียบเทียบ Permutation vs Combination</h3>
        <p>กราฟด้านล่างแสดงจำนวนวิธีของ P<sub>n,r</sub> และ C<sub>n,r</sub> เมื่อกำหนด n = 6 แล้วเปลี่ยนค่าของ r เพื่อเห็นความแตกต่างระหว่าง “สนใจลำดับ” และ “ไม่สนใจลำดับ”</p>
        <canvas id="pcChart" height="220"></canvas>
      </div>
    </section>

    <section class="card" id="understanding">
      <h2><span class="badge">Step 4</span> เข้าใจความแตกต่างของ Permutation และ Combination</h2>
      <p>คำถามหลักที่ช่วยจำแนกคือ <strong>“ลำดับสำคัญหรือไม่?”</strong></p>
      <div class="columns two">
        <div class="highlight">
          <h3>Permutation: ลำดับสำคัญ</h3>
          <ul>
            <li>การแข่งขันวิ่ง: ผู้ชนะที่ 1, 2, 3 มีความหมายแตกต่างกัน</li>
            <li>การจัดตำแหน่ง: ประธาน รองประธาน เหรัญญิก</li>
          </ul>
        </div>
        <div class="highlight">
          <h3>Combination: ลำดับไม่สำคัญ</h3>
          <ul>
            <li>เลือกคณะกรรมการ 3 คน: สนใจแค่ว่าได้ใครบ้าง</li>
            <li>เลือกไพ่ 5 ใบ: ลำดับการหยิบไม่มีผลต่อไพ่ในมือ</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="card" id="examples">
      <h2><span class="badge">Step 5</span> ตัวอย่างการประยุกต์</h2>
      <div class="table-wrapper">
        <table class="styled">
          <thead>
            <tr>
              <th>สถานการณ์</th>
              <th>การวิเคราะห์</th>
              <th>วิธีคำนวณ</th>
              <th>คำตอบ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>กฎการคูณ: เสื้อ 3 แบบ × กางเกง 4 แบบ</td>
              <td>สองขั้นตอนต่อเนื่อง เลือกเสื้อ แล้วเลือกกางเกง</td>
              <td>3 × 4</td>
              <td>12 วิธี</td>
            </tr>
            <tr>
              <td>Permutation: นักวิ่ง 8 คน แข่งชิงเหรียญ 3 ตำแหน่ง</td>
              <td>เลือกคน 3 คนจาก 8 คนและสนใจลำดับเข้าเส้นชัย</td>
              <td>\(P_{8,3} = \frac{8!}{5!}\)</td>
              <td>336 วิธี</td>
            </tr>
            <tr>
              <td>Combination: เลือกตัวแทน 3 คนจากนักเรียน 10 คน</td>
              <td>เลือกคน 3 คนโดยไม่สนใจลำดับ</td>
              <td>\(C_{10,3} = \frac{10!}{3!7!}\)</td>
              <td>120 วิธี</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="card" id="self-check">
      <h2><span class="badge">Step 6</span> Self Check</h2>
      <details class="lesson-toggle" open>
        <summary>ลองตอบคำถามท้ายบท</summary>
        <ol>
          <li>หากร้านกาแฟมีเครื่องดื่มร้อน 5 ชนิด และเครื่องดื่มเย็น 8 ชนิด ลูกค้าสั่งเครื่องดื่มได้กี่แบบ? (ใช้กฎการบวก)</li>
          <li>บริษัทต้องการจัดทีมงาน 4 ตำแหน่ง (หัวหน้า, ผู้ช่วย, วิศวกร, นักวิเคราะห์) จากพนักงานทั้งหมด 9 คน มีวิธีจัดกี่แบบ? (Permutation)</li>
          <li>สโมสรอยากเลือกสมาชิก 5 คนจากทั้งหมด 12 คนเพื่อจัดทริป มีวิธีเลือกกี่แบบ? (Combination)</li>
        </ol>
        <p class="note">ลองใช้เครื่องคิดเลขด้านบนเพื่อเช็กคำตอบของคุณ!</p>
      </details>
    </section>
  </main>

  <script>
    const factorialMemo = new Map([[0, 1], [1, 1]]);
    function factorial(n) {
      if (n < 0) return NaN;
      if (factorialMemo.has(n)) return factorialMemo.get(n);
      let result = n * factorial(n - 1);
      factorialMemo.set(n, result);
      return result;
    }

    function updateOutfit() {
      const shirts = Math.max(0, Number(document.getElementById('shirts').value || 0));
      const pants = Math.max(0, Number(document.getElementById('pants').value || 0));
      const ways = shirts * pants;
      document.getElementById('outfitResult').textContent = `มีทั้งหมด ${ways.toLocaleString('th-TH')} วิธีในการแต่งตัว`;
    }

    function calcPermutation() {
      const n = Number(document.getElementById('perm-n').value);
      const r = Number(document.getElementById('perm-r').value);
      if (r > n) {
        document.getElementById('permResult').textContent = 'r ต้องไม่มากกว่า n';
        return;
      }
      const value = factorial(n) / factorial(n - r);
      document.getElementById('permResult').textContent = `Pₙ,ₚ = ${value.toLocaleString('th-TH')} วิธี`;
    }

    function calcCombination() {
      const n = Number(document.getElementById('comb-n').value);
      const r = Number(document.getElementById('comb-r').value);
      if (r > n) {
        document.getElementById('combResult').textContent = 'r ต้องไม่มากกว่า n';
        return;
      }
      const value = factorial(n) / (factorial(r) * factorial(n - r));
      document.getElementById('combResult').textContent = `Cₙ,ₚ = ${value.toLocaleString('th-TH')} วิธี`;
    }

    document.getElementById('calcOutfit').addEventListener('click', updateOutfit);
    document.getElementById('calcPerm').addEventListener('click', calcPermutation);
    document.getElementById('calcComb').addEventListener('click', calcCombination);

    updateOutfit();
    calcPermutation();
    calcCombination();

    const ctx = document.getElementById('pcChart');
    if (ctx) {
      const n = 6;
      const labels = [1, 2, 3, 4, 5, 6];
      const permutationData = labels.map(r => factorial(n) / factorial(n - r));
      const combinationData = labels.map(r => factorial(n) / (factorial(r) * factorial(n - r)));
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels.map(r => `r = ${r}`),
          datasets: [
            {
              label: 'Permutation (P_{n,r})',
              data: permutationData,
              borderColor: '#512da8',
              backgroundColor: 'rgba(81,45,168,0.2)',
              tension: 0.35,
              fill: true,
              pointRadius: 4,
              pointBackgroundColor: '#311b92'
            },
            {
              label: 'Combination (C_{n,r})',
              data: combinationData,
              borderColor: '#ff7043',
              backgroundColor: 'rgba(255,112,67,0.18)',
              tension: 0.35,
              fill: true,
              pointRadius: 4,
              pointBackgroundColor: '#e64a19'
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              labels: {
                font: { size: 13 }
              }
            },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString('th-TH')} วิธี`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => value.toLocaleString('th-TH')
              },
              title: {
                display: true,
                text: 'จำนวนวิธี (ways)'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
