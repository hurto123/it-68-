<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>บทที่ 8: การแจกแจงทวินาม</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    :root { color-scheme: light dark; }
    body.page {
      min-height: 100vh;
      background: linear-gradient(150deg, rgba(255,243,224,0.9), rgba(255,236,179,0.9));
      font-family: "IBM Plex Sans Thai", "Prompt", "Sarabun", system-ui, sans-serif;
    }
    main.container { max-width: 1120px; margin: 0 auto; padding: clamp(2rem,5vw,3.5rem); }
    header.hero {
      background: linear-gradient(135deg, #ff8f00, #ffa726);
      color: #fff;
      padding: clamp(2.8rem,6vw,4rem);
      border-radius: 32px;
      position: relative;
      overflow: hidden;
      margin-bottom: 2.4rem;
      box-shadow: 0 30px 48px rgba(255,143,0,0.28);
    }
    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.4), transparent 60%),
                  radial-gradient(circle at 20% 70%, rgba(255,255,255,0.25), transparent 70%);
    }
    header.hero h1 { font-size: clamp(2.5rem,3vw+1.6rem,3.7rem); margin-bottom: 0.7rem; }
    header.hero p { font-size: 1.12rem; max-width: 760px; line-height: 1.7; }
    section.card {
      background: rgba(255,255,255,0.95);
      border-radius: 26px;
      padding: clamp(1.7rem,4vw,2.8rem);
      margin-bottom: 2.2rem;
      box-shadow: 0 22px 38px rgba(255,143,0,0.16);
    }
    h2 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #e65100;
      font-size: 1.95rem;
    }
    .badge { border-radius: 999px; padding: 0.2rem 0.9rem; background: rgba(255,224,178,0.9); color: #e65100; font-weight: 600; }
    .grid { display: grid; gap: 1.4rem; }
    @media (min-width: 950px) { .grid.two { grid-template-columns: repeat(2, minmax(0,1fr)); } .grid.three { grid-template-columns: repeat(3, minmax(0,1fr)); } }
    article.definition {
      border-radius: 20px;
      background: linear-gradient(155deg, rgba(255,224,178,0.6), rgba(255,243,224,0.75));
      border: 1px solid rgba(230,81,0,0.2);
      padding: 1.4rem 1.6rem;
      display: grid;
      gap: 0.7rem;
    }
    article.definition strong { font-size: 1.1rem; color: #bf360c; }
    .highlight { border-left: 6px solid #fb8c00; background: rgba(251,140,0,0.12); border-radius: 18px; padding: 1rem 1.2rem; }
    .code-box { background: #331b00; color: #ffe0b2; padding: 1rem 1.2rem; border-radius: 14px; font-family: "Fira Code", "Consolas", monospace; font-size: 0.95rem; overflow-x: auto; }
    .note { color: #e65100; font-size: 0.95rem; }
    .pill-list { display:flex; flex-wrap:wrap; gap:0.65rem; }
    .pill { padding:0.35rem 0.85rem; border-radius:999px; background:rgba(255,204,128,0.6); color:#bf360c; font-weight:600; font-size:0.88rem; }
    .calculator { display:grid; gap:1rem; margin-top:1.1rem; }
    .calculator label { font-weight:600; color:#bf360c; }
    .calculator input, .calculator select {
      border-radius:14px;
      border:1px solid rgba(230,81,0,0.35);
      padding:0.65rem 0.85rem;
      font-size:1rem;
      background:rgba(255,253,231,0.9);
    }
    .calculator input[type="range"] { padding:0; }
    .calculator button {
      border:none;
      border-radius:999px;
      padding:0.75rem 1.8rem;
      background:linear-gradient(135deg,#f57c00,#ffa726);
      color:#fff3e0;
      font-weight:600;
      cursor:pointer;
      justify-self:flex-start;
      transition:transform 0.2s ease, box-shadow 0.2s ease;
    }
    .calculator button:hover { transform:translateY(-1px); box-shadow:0 12px 26px rgba(245,124,0,0.3); }
    .result-card {
      border-radius:18px;
      background:rgba(255,183,77,0.18);
      color:#e65100;
      padding:1rem 1.3rem;
      font-weight:600;
      display:none;
      gap:0.35rem;
    }
    .table-wrapper { overflow-x:auto; border-radius:16px; border:1px solid rgba(230,81,0,0.2); margin-top:1.3rem; display:none; }
    table.styled { width:100%; border-collapse:collapse; min-width:520px; }
    table.styled th, table.styled td { padding:0.85rem 1.1rem; text-align:center; }
    table.styled thead { background:rgba(255,224,178,0.7); color:#bf360c; }
    table.styled tbody tr:nth-child(even) { background:rgba(255,243,224,0.65); }
    details.toggle { background:rgba(255,224,178,0.55); border-radius:18px; padding:1rem 1.1rem; border:1px solid rgba(255,183,77,0.6); }
    details.toggle summary { cursor:pointer; font-weight:600; color:#bf360c; }
    canvas { max-width:100%; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
  <main class="container">
    <header class="hero">
      <h1>บทเรียนที่ 8: การแจกแจงทวินาม (Binomial Distribution)</h1>
      <p>จับหลักของการนับจำนวนความสำเร็จจากการทดลองที่มีแค่สองผลลัพธ์: <strong>สำเร็จ</strong> หรือ <strong>ล้มเหลว</strong> พร้อมตัวอย่างจริงตั้งแต่การโยนเหรียญ การสอบ ไปจนถึงการควบคุมคุณภาพ</p>
    </header>

    <section class="card" id="setup">
      <h2><span class="badge">Understand</span> เงื่อนไข 4 ข้อสำคัญ</h2>
      <div class="grid two">
        <article class="definition">
          <strong>สูตร PMF</strong>
          <div class="code-box">P(X = x) = \binom{n}{x} p^x (1-p)^{n-x}</div>
          <div class="highlight">
            <ul>
              <li>X: จำนวนความสำเร็จ</li>
              <li>n: จำนวนครั้งทดลอง</li>
              <li>p: โอกาสสำเร็จในแต่ละครั้ง (คงที่)</li>
            </ul>
          </div>
        </article>
        <article class="definition">
          <strong>เช็กลิสต์การใช้</strong>
          <div class="pill-list">
            <span class="pill">จำนวนครั้งแน่นอน (n)</span>
            <span class="pill">แต่ละครั้งเป็นอิสระ</span>
            <span class="pill">ผลลัพธ์มี 2 แบบ</span>
            <span class="pill">p คงที่ทุกครั้ง</span>
          </div>
          <p class="note">ถ้าเงื่อนไขขาดข้อใดข้อหนึ่ง ให้พิจารณาการแจกแจงอื่นแทน</p>
        </article>
      </div>
    </section>

    <section class="card" id="stats">
      <h2><span class="badge">Moments</span> ค่าเฉลี่ยและความแปรปรวน</h2>
      <div class="grid two">
        <article class="definition">
          <strong>ค่าคาดหวัง</strong>
          <div class="code-box">E(X) = np</div>
          <p class="note">จำนวนครั้งที่เราคาดว่าจะสำเร็จโดยเฉลี่ย</p>
        </article>
        <article class="definition">
          <strong>ความแปรปรวน</strong>
          <div class="code-box">V(X) = np(1-p)</div>
          <p class="note">ยิ่ง p ใกล้ 0 หรือ 1 ความแปรปรวนจะลดลง</p>
        </article>
      </div>
      <details class="toggle" style="margin-top:1.2rem;">
        <summary>เหตุผลที่ต้องมี \(\binom{n}{x}\)</summary>
        <p>เมื่อเราพูดว่ามีความสำเร็จ x ครั้ง เราไม่ได้ระบุว่ามันเกิดในรอบไหนบ้าง การเลือกว่าจะให้ความสำเร็จเกิดในรอบใดจึงมี \(\binom{n}{x}\) วิธี และแต่ละวิธีมีความน่าจะเป็นเดียวกันคือ p^x(1-p)^{n-x}</p>
      </details>
    </section>

    <section class="card" id="playground">
      <h2><span class="badge">Playground</span> เครื่องคิดเลขการแจกแจงทวินาม</h2>
      <div class="calculator">
        <label for="scenario">เลือกสถานการณ์</label>
        <select id="scenario">
          <option value="">-- เลือก --</option>
          <option value="coin">โยนเหรียญ 10 ครั้ง (p=0.5)</option>
          <option value="quiz">เดาข้อสอบ 5 ข้อ ตัวเลือก 4 ตัว (p=0.25)</option>
          <option value="quality">ตรวจสินค้าล็อต 20 ชิ้น โอกาสชำรุด 5% (p=0.05)</option>
        </select>
        <label for="n-input">จำนวนครั้งทดลอง (n): <strong id="n-display">10</strong></label>
        <input type="range" id="n-input" min="1" max="60" value="10" />
        <label for="p-input">โอกาสสำเร็จในแต่ละครั้ง (p): <strong id="p-display">0.50</strong></label>
        <input type="range" id="p-input" min="0" max="1" step="0.01" value="0.5" />
        <label for="x-input">จำนวนความสำเร็จที่สนใจ (x)</label>
        <input type="number" id="x-input" min="0" value="5" />
        <button id="calc-btn">คำนวณความน่าจะเป็น</button>
      </div>
      <div id="result-card" class="result-card"></div>
      <div class="table-wrapper" id="table-wrapper">
        <table class="styled" id="binomial-table">
          <thead><tr><th>x</th><th>P(X=x)</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <canvas id="binomial-chart" height="260" style="margin-top:1.4rem;"></canvas>
    </section>

    <section class="card" id="example">
      <h2><span class="badge">Example</span> เดาข้อสอบให้ถูก 2 ข้อ</h2>
      <div class="grid two">
        <article class="definition">
          <strong>โจทย์</strong>
          <p>ข้อสอบปรนัย 5 ข้อ แต่ละข้อมี 4 ตัวเลือก นักเรียนเดาอย่างเดียว อยากรู้ว่าจะเดาถูก 2 ข้อพอดี</p>
          <div class="code-box">n = 5, p = 0.25\nP(X=2) = \binom{5}{2}(0.25)^2(0.75)^3 \approx 0.2637\nE(X) = 5 × 0.25 = 1.25\nV(X) = 5 × 0.25 × 0.75 = 0.9375</div>
        </article>
        <article class="definition">
          <strong>ตีความ</strong>
          <ul>
            <li>โอกาสเดาถูก 2 ข้อ ≈ 26.37%</li>
            <li>ค่าเฉลี่ย 1.25 ข้อ หมายถึงโดยเฉลี่ยจะเดาถูกแค่ประมาณ 1 ข้อ</li>
            <li>หากเพิ่มจำนวนข้อ n หรือเปลี่ยน p กราฟจะเปลี่ยนรูปทันที</li>
          </ul>
          <div class="highlight">
            <p>การแจกแจงทวินามเชื่อมโยงกับบทก่อน (Combination) โดยตรง เพราะต้องรู้จำนวนวิธีการเลือกความสำเร็จ x ครั้งจาก n ครั้ง</p>
          </div>
        </article>
      </div>
      <details class="toggle" style="margin-top:1.2rem;">
        <summary>Tips</summary>
        <ul>
          <li>หาก n ใหญ่และ p ไม่เล็กหรือใหญ่เกินไป กราฟจะใกล้เคียงปกติ (Normal Approximation)</li>
          <li>ใช้สูตรสะสม: P(X ≤ k) = ∑<sub>x=0</sub><sup>k</sup> \binom{n}{x} p^x(1-p)^{n-x}</li>
          <li>หากทดลองโดยไม่ใส่คืนจากประชากรเล็ก ให้พิจารณาการแจกแจงไฮเปอร์จีออเมตริกแทน</li>
        </ul>
      </details>
    </section>
  </main>

  <script>
    const scenarioSelect = document.getElementById('scenario');
    const nInput = document.getElementById('n-input');
    const pInput = document.getElementById('p-input');
    const xInput = document.getElementById('x-input');
    const nDisplay = document.getElementById('n-display');
    const pDisplay = document.getElementById('p-display');
    const calcBtn = document.getElementById('calc-btn');
    const resultCard = document.getElementById('result-card');
    const tableWrapper = document.getElementById('table-wrapper');
    const tableBody = document.querySelector('#binomial-table tbody');
    let binomialChart;

    const scenarios = {
      coin: { n: 10, p: 0.5, x: 5 },
      quiz: { n: 5, p: 0.25, x: 2 },
      quality: { n: 20, p: 0.05, x: 1 }
    };

    scenarioSelect.addEventListener('change', () => {
      const data = scenarios[scenarioSelect.value];
      if (!data) return;
      nInput.value = data.n;
      pInput.value = data.p;
      xInput.value = data.x;
      updateDisplays();
      calculate();
    });

    function updateDisplays() {
      const n = parseInt(nInput.value, 10);
      const p = parseFloat(pInput.value);
      nDisplay.textContent = n;
      pDisplay.textContent = p.toFixed(2);
      xInput.max = n;
    }

    function factorial(n) {
      if (n === 0 || n === 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i += 1) result *= i;
      return result;
    }

    function combination(n, k) {
      if (k < 0 || k > n) return 0;
      if (k === 0 || k === n) return 1;
      k = Math.min(k, n - k);
      let numerator = 1;
      let denominator = 1;
      for (let i = 1; i <= k; i += 1) {
        numerator *= (n - (k - i));
        denominator *= i;
      }
      return numerator / denominator;
    }

    function binomialProbability(n, p, x) {
      return combination(n, x) * Math.pow(p, x) * Math.pow(1 - p, n - x);
    }

    function calculate() {
      const n = parseInt(nInput.value, 10);
      const p = parseFloat(pInput.value);
      const x = Math.min(Math.max(parseInt(xInput.value, 10) || 0, 0), n);
      xInput.value = x;
      const probability = binomialProbability(n, p, x);
      resultCard.style.display = 'grid';
      resultCard.innerHTML = `P(X = ${x}) = ${probability.toFixed(6)} | E(X) = ${(n * p).toFixed(3)} | V(X) = ${(n * p * (1 - p)).toFixed(3)}`;

      tableBody.innerHTML = '';
      const labels = [];
      const data = [];
      for (let i = 0; i <= n; i += 1) {
        const prob = binomialProbability(n, p, i);
        labels.push(i);
        data.push(prob);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i}</td><td>${prob.toFixed(6)}</td>`;
        if (i === x) tr.style.background = 'rgba(255,224,178,0.8)';
        tableBody.appendChild(tr);
      }
      tableWrapper.style.display = 'block';
      renderChart(labels, data, x);
    }

    function renderChart(labels, data, highlightX) {
      const ctx = document.getElementById('binomial-chart');
      if (binomialChart) binomialChart.destroy();
      binomialChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'P(X = x)',
            data,
            backgroundColor: labels.map(x => x === highlightX ? 'rgba(255,138,101,0.7)' : 'rgba(255,183,77,0.6)'),
            borderColor: '#f57c00',
            borderWidth: 1.5,
            borderRadius: 10
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { title: { display: true, text: 'จำนวนครั้งที่สำเร็จ (x)', color: '#bf360c' } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'ความน่าจะเป็น', color: '#bf360c' }
            }
          }
        }
      });
    }

    nInput.addEventListener('input', () => { updateDisplays(); calculate(); });
    pInput.addEventListener('input', () => { updateDisplays(); calculate(); });
    calcBtn.addEventListener('click', calculate);

    updateDisplays();
    calculate();
  </script>
</body>
</html>
