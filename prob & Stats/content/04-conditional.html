<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>บทที่ 4: ความน่าจะเป็นแบบมีเงื่อนไข</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    :root {
      color-scheme: light dark;
    }
    body.page {
      background: linear-gradient(180deg, rgba(255,245,235,0.9), rgba(255,253,231,0.9));
      min-height: 100vh;
    }
    header.hero {
      background: linear-gradient(135deg, #ff9800, #ffb74d);
      color: #3e2723;
      padding: clamp(2.4rem, 5vw, 3.4rem);
      border-radius: 26px;
      margin-bottom: 2.2rem;
      box-shadow: 0 22px 45px rgba(255, 152, 0, 0.25);
      position: relative;
      overflow: hidden;
    }
    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 75% 25%, rgba(255,255,255,0.34), transparent 60%),
                  radial-gradient(circle at 15% 25%, rgba(255,255,255,0.22), transparent 70%);
    }
    header.hero h1 {
      font-size: clamp(2.4rem, 3vw + 1.4rem, 3.7rem);
    }
    section.card {
      background: rgba(255,255,255,0.93);
      border-radius: 22px;
      padding: clamp(1.4rem, 4vw, 2.6rem);
      margin-bottom: 2.1rem;
      box-shadow: 0 16px 36px rgba(230, 81, 0, 0.16);
    }
    h2 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #e65100;
      font-size: 1.85rem;
    }
    h2 .badge {
      padding: 0.1rem 0.85rem;
      border-radius: 999px;
      background: rgba(255, 152, 0, 0.15);
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.4px;
      color: #d84315;
    }
    .definition-grid {
      display: grid;
      gap: 1.4rem;
    }
    @media (min-width: 880px) {
      .definition-grid.two { grid-template-columns: repeat(2, minmax(0,1fr)); }
      .definition-grid.three { grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    .definition-card {
      background: linear-gradient(150deg, rgba(255,224,178,0.6), rgba(255,249,196,0.7));
      border: 1px solid rgba(255, 171, 64, 0.28);
      border-radius: 18px;
      padding: 1.4rem;
      display: grid;
      gap: 0.6rem;
    }
    .definition-card strong {
      font-size: 1.12rem;
      color: #bf360c;
    }
    .highlight {
      padding: 1.2rem 1.4rem;
      border-left: 6px solid #fb8c00;
      background: rgba(255, 183, 77, 0.15);
      border-radius: 14px;
    }
    .code-box {
      background: #311b0b;
      color: #ffecb3;
      font-family: "Fira Code", "Courier New", monospace;
      border-radius: 12px;
      padding: 1rem 1.2rem;
      font-size: 0.96rem;
      overflow-x: auto;
    }
    .calculator {
      display: grid;
      gap: 1rem;
      margin-top: 1rem;
    }
    .calculator label {
      font-weight: 600;
      color: #e65100;
    }
    .calculator input {
      border-radius: 12px;
      border: 1px solid rgba(230, 81, 0, 0.4);
      padding: 0.65rem 0.9rem;
    }
    .calculator button {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ef6c00, #fb8c00);
      color: #fff8e1;
      font-weight: 600;
      padding: 0.75rem 1.6rem;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .calculator button:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 20px rgba(239, 108, 0, 0.26);
    }
    .result-card {
      border-radius: 12px;
      padding: 1rem 1.2rem;
      background: rgba(56,142,60,0.12);
      color: #1b5e20;
      font-weight: 600;
    }
    .note {
      font-size: 0.92rem;
      color: #6d4c41;
    }
    .table-wrapper {
      overflow-x: auto;
      border-radius: 14px;
      border: 1px solid rgba(255, 183, 77, 0.22);
    }
    table.styled {
      width: 100%;
      border-collapse: collapse;
    }
    table.styled th,
    table.styled td {
      padding: 0.9rem 1.1rem;
      text-align: left;
    }
    table.styled thead {
      background: rgba(255, 183, 77, 0.22);
      color: #e65100;
    }
    table.styled tbody tr:nth-child(even) {
      background: rgba(255, 224, 178, 0.25);
    }
    details.toggle {
      background: rgba(255, 224, 178, 0.28);
      border-radius: 16px;
      padding: 1rem 1.2rem;
      border: 1px solid rgba(255, 171, 64, 0.3);
    }
    details.toggle summary {
      cursor: pointer;
      font-weight: 600;
    }
    canvas {
      max-width: 100%;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
  <main class="container">
    <header class="hero">
      <h1>บทเรียนที่ 4: ความน่าจะเป็นแบบมีเงื่อนไขและกฎที่เกี่ยวข้อง</h1>
      <p>เข้าใจสถานการณ์ที่เหตุการณ์มีผลต่อกัน ใช้สูตร P(A|B) เพื่ออัปเดตความเชื่อและประเมินโอกาสเมื่อมีข้อมูลใหม่ พร้อมเรียนรู้กฎการคูณ การบวก เหตุการณ์อิสระ และเหตุการณ์ไม่เกิดร่วมกัน</p>
    </header>

    <section class="card" id="conditional-intro">
      <h2><span class="badge">Step 1</span> ทำความรู้จัก P(A|B)</h2>
      <p>ความน่าจะเป็นแบบมีเงื่อนไขคือโอกาสที่เหตุการณ์ A จะเกิดขึ้นเมื่อทราบว่าเหตุการณ์ B เกิดขึ้นแล้ว ตัวอย่างเช่น เมื่อเห็นเมฆดำเต็มท้องฟ้า โอกาสฝนตกจะมากขึ้นกว่าปกติ</p>
      <div class="highlight">
        <strong>สัญลักษณ์:</strong> P(A|B) อ่านว่า “ความน่าจะเป็นของ A เมื่อกำหนดว่า B เกิดขึ้นแล้ว”</div>
    </section>

    <section class="card" id="formulas">
      <h2><span class="badge">Step 2</span> สูตรสำคัญ</h2>
      <div class="definition-grid two">
        <article class="definition-card">
          <strong>สูตรความน่าจะเป็นแบบมีเงื่อนไข</strong>
          <div class="code-box">
P(A|B) = \(\dfrac{P(A \cap B)}{P(B)}\), &nbsp; P(B) > 0
          </div>
          <p>ปรับมุมมองให้ B กลายเป็นแซมเปิลสเปซใหม่ แล้วประเมินโอกาสที่ A จะเกิดในบริบทนั้น</p>
        </article>
        <article class="definition-card">
          <strong>กฎการคูณ</strong>
          <div class="code-box">
P(A \cap B) = P(B) · P(A|B) = P(A) · P(B|A)
          </div>
          <p>ใช้หาโอกาสที่ A และ B จะเกิดพร้อมกัน โดยเลือกมองจาก A หรือ B ก่อนก็ได้</p>
        </article>
      </div>
      <div class="definition-grid two" style="margin-top: 1.2rem;">
        <article class="definition-card">
          <strong>เหตุการณ์อิสระ (Independent Events)</strong>
          <p>การเกิดของ A ไม่ส่งผลต่อความน่าจะเป็นของ B: P(A|B) = P(A)</p>
          <div class="code-box">
เมื่อ A และ B เป็นอิสระ ⇒ P(A \cap B) = P(A) · P(B)
          </div>
        </article>
        <article class="definition-card">
          <strong>กฎการบวกทั่วไป</strong>
          <div class="code-box">
P(A ∪ B) = P(A) + P(B) − P(A ∩ B)
          </div>
          <p>บวกโอกาสของแต่ละเหตุการณ์แล้วลบส่วนที่นับซ้ำ (A ∩ B)</p>
        </article>
      </div>
    </section>

    <section class="card" id="independent-exclusive">
      <h2><span class="badge">Step 3</span> แยกให้ออก: Independent vs Mutually Exclusive</h2>
      <div class="definition-grid two">
        <div class="highlight">
          <h3>Independent</h3>
          <ul>
            <li>การโยนเหรียญครั้งที่ 1 และครั้งที่ 2: ผลลัพธ์ไม่เกี่ยวข้องกัน</li>
            <li>ใช้สูตร P(A ∩ B) = P(A)P(B)</li>
            <li>สามารถเกิดพร้อมกันได้</li>
          </ul>
        </div>
        <div class="highlight">
          <h3>Mutually Exclusive</h3>
          <ul>
            <li>ทอดลูกเต๋าครั้งเดียว: ได้แต้ม 1 กับ 6 พร้อมกันไม่ได้</li>
            <li>การเกิดของ A ทำให้ B เกิดไม่ได้ทันที</li>
            <li>P(A ∩ B) = 0</li>
          </ul>
        </div>
      </div>
    </section>

    <section class="card" id="interactive-tools">
      <h2><span class="badge">Step 4</span> เครื่องมือโต้ตอบ</h2>
      <div class="definition-grid two">
        <div class="card" style="background: rgba(255,224,178,0.45);">
          <h3>คำนวณ P(A|B)</h3>
          <div class="calculator">
            <label>P(A ∩ B)
              <input type="number" id="joint" value="0.3" step="0.01" min="0" max="1" />
            </label>
            <label>P(B)
              <input type="number" id="pb" value="0.5" step="0.01" min="0" max="1" />
            </label>
            <button type="button" id="calcConditional">คำนวณ</button>
            <div class="result-card" id="conditionalResult">P(A|B) = 0.600</div>
          </div>
        </div>
        <div class="card" style="background: rgba(255,224,178,0.45);">
          <h3>อัปเดตความน่าจะเป็นของเหตุการณ์ผลไม้</h3>
          <p class="note">ใช้ตัวอย่างตะกร้าผลไม้: แอปเปิ้ลสีแดง 3 ผล, แอปเปิ้ลสีเขียว 1 ผล, ส้มสีแดง 2 ผล, ส้มสีเขียว 4 ผล</p>
          <div class="calculator">
            <label>เลือกรายการที่สนใจ
              <select id="fruit-select">
                <option value="apple">หยิบได้แอปเปิ้ลเมื่อรู้ว่าเป็นสีแดง</option>
                <option value="orange">หยิบได้ส้มเมื่อรู้ว่าเป็นสีเขียว</option>
                <option value="red">หยิบได้ผลไม้สีแดงหรือแอปเปิ้ล</option>
              </select>
            </label>
            <div class="result-card" id="fruitResult">P(A|B) = 0.600</div>
          </div>
        </div>
      </div>
      <canvas id="conditionalChart" height="220" style="margin-top: 2rem;"></canvas>
    </section>

    <section class="card" id="examples">
      <h2><span class="badge">Step 5</span> ตัวอย่างโจทย์พร้อมเฉลย</h2>
      <div class="table-wrapper">
        <table class="styled">
          <thead>
            <tr>
              <th>โจทย์</th>
              <th>การวิเคราะห์</th>
              <th>คำตอบ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>คำนวณ P(A|B) จากตะกร้าผลไม้เมื่อรู้ว่าได้ผลไม้สีแดง</td>
              <td>P(A ∩ B) = 3/10, P(B) = 5/10</td>
              <td>P(A|B) = 0.6</td>
            </tr>
            <tr>
              <td>หา P(A ∪ B) สำหรับ “แอปเปิ้ล” หรือ “สีแดง”</td>
              <td>P(A)=4/10, P(B)=5/10, P(A∩B)=3/10</td>
              <td>P(A ∪ B) = 0.6</td>
            </tr>
          </tbody>
        </table>
      </div>
      <details class="toggle" open>
        <summary>บทสรุป</summary>
        <p>P(A|B) ช่วยให้เราปรับค่าความน่าจะเป็นตามข้อมูลใหม่ กฎการคูณและการบวกเป็นเครื่องมือสำคัญในการวิเคราะห์เหตุการณ์ที่สัมพันธ์กัน ส่วนการแยกแยะ Independent กับ Mutually Exclusive จะช่วยป้องกันความสับสนในการเลือกใช้สูตร</p>
      </details>
    </section>
  </main>

  <script>
    const jointInput = document.getElementById('joint');
    const pbInput = document.getElementById('pb');
    const conditionalResult = document.getElementById('conditionalResult');

    function calcConditionalProb() {
      const joint = Number(jointInput.value);
      const pb = Number(pbInput.value);
      if (pb <= 0 || joint < 0 || joint > pb) {
        conditionalResult.textContent = 'กรุณากรอกค่าที่ถูกต้อง (0 ≤ P(A ∩ B) ≤ P(B))';
        return;
      }
      const value = joint / pb;
      conditionalResult.textContent = `P(A|B) = ${value.toFixed(3)}`;
    }

    document.getElementById('calcConditional').addEventListener('click', calcConditionalProb);
    calcConditionalProb();

    const fruitSelect = document.getElementById('fruit-select');
    const fruitResult = document.getElementById('fruitResult');

    const fruitData = {
      total: 10,
      appleRed: 3,
      appleGreen: 1,
      orangeRed: 2,
      orangeGreen: 4
    };

    function updateFruitScenario() {
      const choice = fruitSelect.value;
      let message = '';
      if (choice === 'apple') {
        const pJoint = fruitData.appleRed / fruitData.total;
        const pB = (fruitData.appleRed + fruitData.orangeRed) / fruitData.total;
        message = `P(แอปเปิ้ล | สีแดง) = ${(pJoint / pB).toFixed(3)} (หรือ ${(pJoint / pB * 100).toFixed(1)}%)`;
      } else if (choice === 'orange') {
        const pJoint = fruitData.orangeGreen / fruitData.total;
        const pB = (fruitData.appleGreen + fruitData.orangeGreen) / fruitData.total;
        message = `P(ส้ม | สีเขียว) = ${(pJoint / pB).toFixed(3)}`;
      } else {
        const pA = (fruitData.appleRed + fruitData.appleGreen) / fruitData.total;
        const pB = (fruitData.appleRed + fruitData.orangeRed) / fruitData.total;
        const pJoint = fruitData.appleRed / fruitData.total;
        message = `P(แอปเปิ้ล ∪ สีแดง) = ${(pA + pB - pJoint).toFixed(3)}`;
      }
      fruitResult.textContent = message;
      updateChart(choice);
    }

    fruitSelect.addEventListener('change', updateFruitScenario);
    updateFruitScenario();

    const ctx = document.getElementById('conditionalChart');
    const conditionalChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['แอปเปิ้ลแดง', 'แอปเปิ้ลเขียว', 'ส้มแดง', 'ส้มเขียว'],
        datasets: [
          {
            label: 'จำนวนผลไม้',
            data: [fruitData.appleRed, fruitData.appleGreen, fruitData.orangeRed, fruitData.orangeGreen],
            backgroundColor: ['#fb8c00', '#ffa726', '#ff7043', '#ffcc80'],
            borderRadius: 12
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.label}: ${ctx.parsed.y} ผล`
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              precision: 0
            },
            title: {
              display: true,
              text: 'จำนวนผลไม้'
            }
          }
        }
      }
    });

    function updateChart(choice) {
      const highlightColor = '#f4511e';
      const baseColors = ['#fb8c00', '#ffa726', '#ff7043', '#ffcc80'];
      let highlightIndex = -1;
      if (choice === 'apple') highlightIndex = 0;
      else if (choice === 'orange') highlightIndex = 3;
      conditionalChart.data.datasets[0].backgroundColor = baseColors.map((c, idx) => idx === highlightIndex ? highlightColor : c);
      conditionalChart.update();
    }
  </script>
</body>
</html>
