<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>บทที่ 9: การแจกแจงไฮเปอร์จีออเมตริก</title>
  <link rel="stylesheet" href="../style.css" />
  <style>
    :root { color-scheme: light dark; }
    body.page {
      min-height: 100vh;
      background: linear-gradient(150deg, rgba(232,248,239,0.92), rgba(200,230,201,0.92));
      font-family: "IBM Plex Sans Thai", "Prompt", "Sarabun", system-ui, sans-serif;
    }
    main.container { max-width: 1120px; margin: 0 auto; padding: clamp(2rem,5vw,3.5rem); }
    header.hero {
      background: linear-gradient(135deg, #2e7d32, #66bb6a);
      color: #fff;
      padding: clamp(2.8rem,6vw,4rem);
      border-radius: 32px;
      position: relative;
      overflow: hidden;
      margin-bottom: 2.4rem;
      box-shadow: 0 30px 50px rgba(46,125,50,0.26);
    }
    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.35), transparent 60%),
                  radial-gradient(circle at 18% 70%, rgba(255,255,255,0.22), transparent 70%);
    }
    header.hero h1 { font-size: clamp(2.4rem,3vw+1.5rem,3.6rem); margin-bottom: 0.7rem; }
    header.hero p { font-size: 1.1rem; max-width: 740px; line-height: 1.7; }
    section.card {
      background: rgba(255,255,255,0.95);
      border-radius: 26px;
      padding: clamp(1.7rem,4vw,2.7rem);
      margin-bottom: 2.2rem;
      box-shadow: 0 22px 38px rgba(56,142,60,0.18);
    }
    h2 {
      display:flex;
      align-items:center;
      gap:0.75rem;
      color:#1b5e20;
      font-size:1.95rem;
    }
    .badge { background: rgba(200,230,201,0.85); color:#1b5e20; border-radius:999px; padding:0.18rem 0.85rem; font-weight:600; }
    .grid { display:grid; gap:1.4rem; }
    @media (min-width:950px) { .grid.two { grid-template-columns: repeat(2,minmax(0,1fr)); } }
    article.definition {
      border-radius:20px;
      background: linear-gradient(155deg, rgba(200,230,201,0.55), rgba(232,245,233,0.7));
      border:1px solid rgba(56,142,60,0.2);
      padding:1.4rem 1.6rem;
      display:grid;
      gap:0.7rem;
    }
    article.definition strong { color:#1b5e20; font-size:1.1rem; }
    .highlight { border-left:6px solid #43a047; background: rgba(76,175,80,0.12); border-radius:18px; padding:1rem 1.2rem; }
    .code-box { background:#0d2614; color:#c8e6c9; padding:1rem 1.2rem; border-radius:14px; font-family:"Fira Code","Consolas",monospace; font-size:0.95rem; overflow-x:auto; }
    .note { color:#2e7d32; font-size:0.95rem; }
    .calculator { display:grid; gap:1rem; margin-top:1.1rem; }
    .calculator label { font-weight:600; color:#1b5e20; }
    .calculator input {
      border-radius:14px;
      border:1px solid rgba(46,125,50,0.35);
      padding:0.65rem 0.85rem;
      font-size:1rem;
      background:rgba(241,248,233,0.9);
    }
    .calculator button {
      border:none;
      border-radius:999px;
      padding:0.75rem 1.8rem;
      background:linear-gradient(135deg,#2e7d32,#66bb6a);
      color:#f1f8e9;
      font-weight:600;
      cursor:pointer;
      justify-self:flex-start;
      transition:transform 0.2s ease, box-shadow 0.2s ease;
    }
    .calculator button:hover { transform:translateY(-1px); box-shadow:0 12px 26px rgba(46,125,50,0.3); }
    .result-card {
      border-radius:18px;
      background:rgba(76,175,80,0.14);
      color:#1b5e20;
      padding:1rem 1.3rem;
      font-weight:600;
      display:none;
      gap:0.35rem;
    }
    .table-wrapper { overflow-x:auto; border-radius:16px; border:1px solid rgba(46,125,50,0.22); margin-top:1.3rem; display:none; }
    table.styled { width:100%; border-collapse:collapse; min-width:520px; }
    table.styled th, table.styled td { padding:0.85rem 1.1rem; text-align:center; }
    table.styled thead { background:rgba(200,230,201,0.65); color:#1b5e20; }
    table.styled tbody tr:nth-child(even) { background:rgba(232,245,233,0.6); }
    details.toggle { background:rgba(200,230,201,0.5); border-radius:18px; padding:1rem 1.1rem; border:1px solid rgba(165,214,167,0.6); }
    details.toggle summary { cursor:pointer; font-weight:600; color:#1b5e20; }
    canvas { max-width:100%; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="page">
  <main class="container">
    <header class="hero">
      <h1>บทเรียนที่ 9: การแจกแจงไฮเปอร์จีออเมตริก (Hypergeometric)</h1>
      <p>เข้าใจสถานการณ์สุ่มโดยไม่ใส่คืน ซึ่งทำให้โอกาสเปลี่ยนไปทุกครั้งที่หยิบ เช่น การสุ่มไพ่ การควบคุมคุณภาพ หรือการเลือกคณะกรรมการจากกลุ่มคนจำนวนจำกัด</p>
    </header>

    <section class="card" id="concept">
      <h2><span class="badge">Concept</span> เมื่อการสุ่มไม่อิสระอีกต่อไป</h2>
      <div class="grid two">
        <article class="definition">
          <strong>สูตร PMF</strong>
          <div class="code-box">P(X = x) = \dfrac{\binom{M}{x} \binom{N - M}{n - x}}{\binom{N}{n}}</div>
          <div class="highlight">
            <ul>
              <li>N: จำนวนทั้งหมด</li>
              <li>M: จำนวนที่เป็น “สำเร็จ” ในประชากร</li>
              <li>n: ขนาดตัวอย่างที่หยิบ</li>
              <li>x: จำนวนสำเร็จที่สนใจ</li>
            </ul>
          </div>
        </article>
        <article class="definition">
          <strong>ค่าคาดหวัง</strong>
          <div class="code-box">E(X) = n \left( \frac{M}{N} \right)</div>
          <p class="note">สัดส่วนของสำเร็จในประชากร คูณด้วยจำนวนที่หยิบ</p>
          <div class="highlight">
            <p>หาก N ใหญ่มากเมื่อเทียบกับ n ผลลัพธ์จะใกล้เคียงกับการแจกแจงทวินามที่มี p = M/N</p>
          </div>
        </article>
      </div>
    </section>

    <section class="card" id="playground">
      <h2><span class="badge">Playground</span> เครื่องคิดเลขไฮเปอร์จีออเมตริก</h2>
      <div class="calculator">
        <label for="N">ขนาดประชากรทั้งหมด (N)</label>
        <input type="number" id="N" value="50" min="1" />
        <label for="M">จำนวนที่เป็นความสำเร็จในประชากร (M)</label>
        <input type="number" id="M" value="20" min="0" />
        <label for="n">ขนาดตัวอย่างที่หยิบ (n)</label>
        <input type="number" id="n" value="10" min="1" />
        <label for="x">จำนวนสำเร็จที่สนใจ (x)</label>
        <input type="number" id="x" value="4" min="0" />
        <button id="calc-btn">คำนวณ</button>
      </div>
      <div id="result-card" class="result-card"></div>
      <div class="table-wrapper" id="table-wrapper">
        <table class="styled" id="table">
          <thead><tr><th>x</th><th>P(X=x)</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <canvas id="chart" height="260" style="margin-top:1.5rem;"></canvas>
    </section>

    <section class="card" id="example">
      <h2><span class="badge">Example</span> ควบคุมคุณภาพปากกา</h2>
      <div class="grid two">
        <article class="definition">
          <strong>โจทย์</strong>
          <p>ปากกาทั้งหมด 12 ด้าม มีสีน้ำเงิน (สำเร็จ) 5 ด้าม ถ้าสุ่มหยิบ 3 ด้ามโดยไม่ใส่คืน อยากรู้ว่าหยิบได้สีน้ำเงิน 2 ด้ามพอดี</p>
          <div class="code-box">N = 12, M = 5, n = 3, x = 2\nP(X=2) = \dfrac{\binom{5}{2} \binom{7}{1}}{\binom{12}{3}} = \dfrac{70}{220} \approx 0.318\nE(X) = 3 × (5/12) = 1.25</div>
        </article>
        <article class="definition">
          <strong>ตีความ</strong>
          <ul>
            <li>โอกาสได้สีน้ำเงิน 2 ด้าม ≈ 31.8%</li>
            <li>ค่าเฉลี่ย 1.25 ด้าม สะท้อนว่าการหยิบ 3 ด้ามโดยเฉลี่ยจะได้สีน้ำเงินประมาณ 1 ด้าม</li>
            <li>หากหยิบเสร็จแล้วนำกลับ (ใส่คืน) จะกลับไปใช้การแจกแจงทวินามแทน</li>
          </ul>
          <div class="highlight">
            <p>ไฮเปอร์จีออเมตริกเน้น <strong>ไม่ใส่คืน</strong> ทุกครั้งที่หยิบจะลดจำนวนของทั้งสองประเภท ทำให้ความน่าจะเป็นเปลี่ยนตลอดเวลา</p>
          </div>
        </article>
      </div>
      <details class="toggle" style="margin-top:1.2rem;">
        <summary>เปรียบเทียบทวินาม vs ไฮเปอร์</summary>
        <ul>
          <li>ทวินาม: เหมาะกับการสุ่มที่ <em>เป็นอิสระ</em> หรือประชากรใหญ่มาก</li>
          <li>ไฮเปอร์: เหมาะกับการสุ่ม <em>ไม่ใส่คืน</em> จากประชากรจำกัด</li>
          <li>เมื่อ N ≥ 20n สามารถใช้ทวินามประมาณได้เพื่อลดขั้นตอน</li>
        </ul>
      </details>
    </section>
  </main>

  <script>
    const NInput = document.getElementById('N');
    const MInput = document.getElementById('M');
    const nInput = document.getElementById('n');
    const xInput = document.getElementById('x');
    const calcBtn = document.getElementById('calc-btn');
    const resultCard = document.getElementById('result-card');
    const tableWrapper = document.getElementById('table-wrapper');
    const tableBody = document.querySelector('#table tbody');
    let chart;

    function combination(n, k) {
      if (k < 0 || k > n) return 0;
      if (k === 0 || k === n) return 1;
      k = Math.min(k, n - k);
      let numerator = 1;
      let denominator = 1;
      for (let i = 1; i <= k; i += 1) {
        numerator *= (n - (k - i));
        denominator *= i;
      }
      return numerator / denominator;
    }

    function hyperProb(N, M, n, x) {
      return (combination(M, x) * combination(N - M, n - x)) / combination(N, n);
    }

    function calculate() {
      const N = Math.max(1, parseInt(NInput.value, 10) || 1);
      const M = Math.min(Math.max(0, parseInt(MInput.value, 10) || 0), N);
      const n = Math.min(Math.max(1, parseInt(nInput.value, 10) || 1), N);
      const xMax = Math.min(M, n);
      const x = Math.min(Math.max(parseInt(xInput.value, 10) || 0, 0), xMax);
      MInput.value = M;
      nInput.value = n;
      xInput.value = x;

      const probability = hyperProb(N, M, n, x);
      resultCard.style.display = 'grid';
      resultCard.innerHTML = `P(X = ${x}) = ${probability.toFixed(6)} | E(X) = ${(n * (M / N)).toFixed(3)}`;

      tableBody.innerHTML = '';
      const labels = [];
      const data = [];
      for (let i = 0; i <= xMax; i += 1) {
        const prob = hyperProb(N, M, n, i);
        labels.push(i);
        data.push(prob);
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i}</td><td>${prob.toFixed(6)}</td>`;
        if (i === x) tr.style.background = 'rgba(200,230,201,0.85)';
        tableBody.appendChild(tr);
      }
      tableWrapper.style.display = 'block';
      renderChart(labels, data, x);
    }

    function renderChart(labels, data, highlightX) {
      const ctx = document.getElementById('chart');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'P(X = x)',
            data,
            backgroundColor: labels.map(v => v === highlightX ? 'rgba(102,187,106,0.7)' : 'rgba(165,214,167,0.6)'),
            borderColor: '#2e7d32',
            borderWidth: 1.5,
            borderRadius: 10
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { title: { display: true, text: 'จำนวนสำเร็จ (x)', color: '#1b5e20' } },
            y: {
              beginAtZero: true,
              title: { display: true, text: 'ความน่าจะเป็น', color: '#1b5e20' }
            }
          }
        }
      });
    }

    calcBtn.addEventListener('click', calculate);
    [NInput, MInput, nInput, xInput].forEach(el => el.addEventListener('change', calculate));

    calculate();
  </script>
</body>
</html>
