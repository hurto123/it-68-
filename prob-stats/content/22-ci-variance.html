<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>บทที่ 22 • ช่วงความเชื่อมั่นสำหรับความแปรปรวน</title>
  <meta name="description" content="ทำความรู้จักการประมาณค่าความแปรปรวนและส่วนเบี่ยงเบนมาตรฐานด้วยการแจกแจงไคสแควร์ พร้อมตัวอย่างและห้องทดลองโต้ตอบ" />
  <link rel="stylesheet" href="assets/lesson-theme.css" />
</head>
<body>
  <main class="page">
    <header class="hero">
      <span class="badge">บทเรียนที่ 22</span>
      <h1>การประมาณค่าความแปรปรวน (σ²)</h1>
      <p class="lead">
        วัด “ความสม่ำเสมอ” ของกระบวนการได้อย่างมั่นใจ—ใช้การแจกแจงไคสแควร์เพื่อสร้างช่วงความเชื่อมั่นของความแปรปรวนและส่วนเบี่ยงเบนมาตรฐาน
      </p>
      <div class="stat-grid">
        <div class="stat"><span class="label">ค่าวิกฤต</span><span class="value">χ² (Chi-Square)</span></div>
        <div class="stat"><span class="label">จุดเด่น</span><span class="value">ช่วงไม่สมมาตร</span></div>
        <div class="stat"><span class="label">df</span><span class="value">n − 1</span></div>
      </div>
    </header>

    <section class="card">
      <h2>1. ทำไมความแปรปรวนสำคัญ</h2>
      <ul>
        <li>วิศวกรรม: ต้องการสินค้าที่มีขนาดสม่ำเสมอ (&sigma;² ต่ำ)</li>
        <li>การเงิน: การลงทุนที่ผันผวนต่ำปลอดภัยกว่า</li>
        <li>การศึกษา: คะแนนที่กระจายแคบบอกถึงความสม่ำเสมอของการสอน</li>
      </ul>
    </section>

    <section class="card">
      <h2>2. สูตรพื้นฐาน</h2>
      <div class="highlight-box">
        <strong>ช่วงความเชื่อมั่นของ σ²</strong>
        <p>
          \(\dfrac{(n-1)s^2}{\chi^2_{\alpha/2,\,n-1}} < \sigma^2 < \dfrac{(n-1)s^2}{\chi^2_{1-\alpha/2,\,n-1}}\)
        </p>
        <p class="note">χ²<sub>&alpha/2</sub> คือค่าที่มีพื้นที่ด้านขวาเท่ากับ &alpha;/2 (ค่ามาก) ส่วน χ²<sub>1−&alpha/2</sub> มีพื้นที่ด้านขวาเท่ากับ 1−&alpha;/2 (ค่าน้อย)</p>
      </div>
      <p>สำหรับช่วงของ &sigma; เพียงถอดรากที่สองของขอบเขตทั้งสองฝั่ง</p>
    </section>

    <section class="card">
      <h2>3. คุณสมบัติที่ต้องจำ</h2>
      <div class="grid two">
        <div class="highlight-box">
          <strong>ช่วงไม่สมมาตร</strong>
          <p>ค่า s² ไม่ได้อยู่ตรงกลางของช่วง เพราะโค้ง χ² เบ้ขวา</p>
        </div>
        <div class="highlight-box">
          <strong>ขึ้นกับ df</strong>
          <p>df = n − 1 ยิ่งมาก ช่วงยิ่งแคบ (ค่าวิกฤตเข้าใกล้กัน)</p>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>4. ตัวอย่าง: เครื่องบรรจุกระป๋อง</h2>
      <p>n = 20, s² = 0.015, ระดับความเชื่อมั่น 95%, df = 19</p>
      <p>χ²<sub>0.025,19</sub> = 32.852, χ²<sub>0.975,19</sub> = 8.907</p>
      <p>ช่วงของ σ² = (0.0087, 0.0320) และช่วงของ σ = (0.093, 0.179)</p>
    </section>

    <section class="card">
      <h2>ห้องทดลอง: คำนวณช่วงความเชื่อมั่นของความแปรปรวน</h2>
      <div class="playground">
        <form id="variance-form">
          <div class="control-group inline">
            <label>
              <span>ขนาดตัวอย่าง (n)</span>
              <input type="number" name="n" value="20" min="3" step="1" />
            </label>
            <label>
              <span>ความแปรปรวนตัวอย่าง (s²)</span>
              <input type="number" name="variance" value="0.015" step="0.0001" min="0" />
            </label>
            <label>
              <span>ระดับความเชื่อมั่น</span>
              <select name="confidence">
                <option value="0.90">90%</option>
                <option value="0.95" selected>95%</option>
                <option value="0.99">99%</option>
              </select>
            </label>
          </div>
        </form>
        <div class="result-board">
          <strong id="variance-summary">ช่วงของ σ²:</strong>
          <div class="stat-grid" id="variance-stats"></div>
          <p class="note" id="variance-note"></p>
        </div>
        <div class="canvas-wrap">
          <canvas id="variance-canvas" height="240"></canvas>
        </div>
      </div>
    </section>
  </main>

  <script src="assets/lesson-tools.js"></script>
  <script>
    const {
      formatNumber,
      chiSquareInv,
      drawChiSquare,
      attachResizeRedraw
    } = window.LessonTools;

    const form = document.getElementById('variance-form');
    const summaryEl = document.getElementById('variance-summary');
    const statsEl = document.getElementById('variance-stats');
    const noteEl = document.getElementById('variance-note');
    const canvas = document.getElementById('variance-canvas');

    function updateVariance() {
      const n = Math.max(3, parseFloat(form.elements['n'].value));
      const s2 = Math.max(0, parseFloat(form.elements['variance'].value));
      const confidence = parseFloat(form.elements['confidence'].value) || 0.95;
      const df = n - 1;
      const alpha = 1 - confidence;
      const chiRight = chiSquareInv(1 - alpha / 2, df);
      const chiLeft = chiSquareInv(alpha / 2, df);

      const lowerVar = (df * s2) / chiRight;
      const upperVar = (df * s2) / chiLeft;
      const lowerSd = Math.sqrt(lowerVar);
      const upperSd = Math.sqrt(upperVar);

      summaryEl.textContent = `ช่วงของ σ²: (${formatNumber(lowerVar, 4)}, ${formatNumber(upperVar, 4)})`;

      statsEl.innerHTML = '';
      const stats = [
        { label: 'df', value: formatNumber(df, 0) },
        { label: 'χ² ขวา', value: formatNumber(chiRight, 3) },
        { label: 'χ² ซ้าย', value: formatNumber(chiLeft, 3) },
        { label: 'ช่วงของ σ', value: `${formatNumber(lowerSd, 4)} – ${formatNumber(upperSd, 4)}` }
      ];
      stats.forEach(stat => {
        const div = document.createElement('div');
        div.className = 'stat';
        div.innerHTML = `<span class="label">${stat.label}</span><span class="value">${stat.value}</span>`;
        statsEl.appendChild(div);
      });

      noteEl.textContent = 'χ² เป็นการแจกแจงเบ้ขวา: ค่าจากปลายหางขวาจะทำให้ขอบเขตล่างแคบลง และค่าจากปลายหางซ้ายทำให้ขอบเขตกว้างขึ้น';

      drawChiSquare(canvas, df, chiLeft, chiRight);
    }

    form.addEventListener('input', updateVariance);
    form.addEventListener('change', updateVariance);
    updateVariance();
    attachResizeRedraw(canvas, updateVariance);
  </script>
</body>
</html>
