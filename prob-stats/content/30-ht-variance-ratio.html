<!DOCTYPE html>
<html class="theme-light" lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ทดสอบอัตราส่วนความแปรปรวนสองประชากรด้วย F-test" />
  <title>บทที่ 30 • ทดสอบอัตราส่วนความแปรปรวน (F-test)</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="print.css" media="print" />
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']], displayMath: [['\\[', '\\]']] },
      svg: { fontCache: 'global' },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea'] }
    };
  </script>
  <script defer src="assets/js/reading-tools.js"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #05060f;
      --surface: #12182a;
      --surface-alt: #1a2139;
      --surface-soft: #222a46;
      --text: #f3f5ff;
      --muted: #9fa8ca;
      --accent: #68f7c2;
      --accent-soft: rgba(104, 247, 194, 0.22);
      --border: #27334d;
    }

    body { margin: 0; background: radial-gradient(circle at 12% -12%, rgba(104,247,194,0.22), transparent 58%), radial-gradient(circle at 90% 0%, rgba(115, 152, 255, 0.16), transparent 60%), var(--bg); color: var(--text); font: 16px/1.65 'Sarabun', 'Noto Sans Thai', system-ui, sans-serif; }
    header { background: linear-gradient(135deg, rgba(18, 28, 48, 0.95), rgba(104,247,194,0.24)); border-bottom: 1px solid var(--border); box-shadow: 0 22px 55px rgba(104,247,194,0.18); }
    header .wrap,
    main,
    footer .wrap { max-width: 1080px; margin: 0 auto; padding: 1.2rem 1.35rem 1.8rem; }

    h1, h2, h3 { line-height: 1.25; margin: 0.25rem 0 0.55rem; }
    h1 { font-size: clamp(1.9rem, 4vw, 2.45rem); }
    h2 { font-size: clamp(1.35rem, 3vw, 1.85rem); }
    h3 { font-size: clamp(1.12rem, 2.6vw, 1.35rem); }

    p, ul, ol { margin: 0.45rem 0 0.7rem; }
    a { color: var(--accent); }

    main.wrap { display: grid; gap: 1.2rem; padding-bottom: 4rem; }
    section.card, article.card { background: var(--surface); border-radius: 20px; border: 1px solid rgba(255,255,255,0.08); padding: clamp(1.1rem, 1.6vw, 1.85rem); box-shadow: 0 18px 44px rgba(0,0,0,0.35); }
    .hero { background: var(--surface-alt); display: grid; gap: 0.9rem; }
    .hero p { margin: 0; color: var(--muted); }
    .eyebrow { letter-spacing: 0.16em; text-transform: uppercase; font-size: 0.75rem; color: var(--muted); }

    .calc { display: grid; gap: 0.9rem; background: var(--surface-alt); border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); padding: 1rem 1.1rem; }
    .calc label { display: grid; gap: 0.35rem; font-weight: 600; }
    .calc input, .calc select { background: rgba(12, 18, 28, 0.6); border: 1px solid var(--border); border-radius: 12px; color: var(--text); padding: 0.55rem 0.75rem; font: inherit; }
    .calc button { justify-self: start; border: none; border-radius: 12px; background: var(--accent); color: #063127; font-weight: 700; padding: 0.6rem 1.2rem; cursor: pointer; }

    .result-box { background: var(--surface-soft); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); padding: 0.9rem 1rem; }
    .result-box strong { font-size: 1.05rem; }
    .muted { color: var(--muted); font-size: 0.92rem; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <p class="eyebrow">บทที่ 30</p>
      <h1>ทดสอบอัตราส่วนความแปรปรวน (F-test)</h1>
      <p>ตรวจสอบว่า $\sigma_1^2/\sigma_2^2$ เท่ากับค่าที่สนใจหรือไม่ ด้วยการใช้การแจกแจง F</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <h2>สูตร</h2>
      <ul>
        <li>$F = \dfrac{s_1^2}{s_2^2}$ หากทดสอบ $H_0: \sigma_1^2 = \sigma_2^2$</li>
        <li>$df_1 = n_1 - 1$, $df_2 = n_2 - 1$</li>
        <li>จัดวาง $s_1^2$ ให้เป็นกลุ่มที่มีความแปรปรวนมากกว่าเพื่อให้ $F \ge 1$ ในการทดสอบสองด้าน</li>
      </ul>
    </section>

    <section class="card">
      <h2>เครื่องมือคำนวณ</h2>
      <form class="calc" id="htFForm">
        <label>ทิศทางของ $H_a$
          <select name="tail">
            <option value="two" selected>สองด้าน</option>
            <option value="right">$\sigma_1^2 &gt; \sigma_2^2$</option>
            <option value="left">$\sigma_1^2 &lt; \sigma_2^2$</option>
          </select>
        </label>
        <label>$s_1$ (ส่วนเบี่ยงเบนมาตรฐานกลุ่ม 1)
          <input type="number" step="0.01" name="sd1" value="9.8" min="0" required />
        </label>
        <label>$s_2$ (ส่วนเบี่ยงเบนมาตรฐานกลุ่ม 2)
          <input type="number" step="0.01" name="sd2" value="7.2" min="0" required />
        </label>
        <label>$n_1$
          <input type="number" name="n1" value="25" min="2" required />
        </label>
        <label>$n_2$
          <input type="number" name="n2" value="21" min="2" required />
        </label>
        <label>ระดับนัยสำคัญ
          <select name="alpha">
            <option value="0.10">0.10</option>
            <option value="0.05" selected>0.05</option>
            <option value="0.01">0.01</option>
          </select>
        </label>
        <button type="submit">คำนวณผล</button>
      </form>
      <div class="result-box" id="htFResult">
        <strong>ผลลัพธ์</strong>
        <p class="muted">จะแสดงค่า $F$, p-value และขอบเขตวิกฤต</p>
      </div>
    </section>
  </main>

  <script>
    function gammaln(z) {
      const cof = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let x = z;
      let y = z;
      let tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < cof.length; j++) {
        ser += cof[j] / ++y;
      }
      return Math.log(2.5066282746310005 * ser / x) - tmp;
    }

    function betacf(a, b, x) {
      const MAXITER = 100;
      const EPS = 1e-8;
      let qab = a + b;
      let qap = a + 1;
      let qam = a - 1;
      let c = 1;
      let d = 1 - (qab * x) / qap;
      if (Math.abs(d) < EPS) d = EPS;
      d = 1 / d;
      let h = d;
      for (let m = 1, m2 = 2; m <= MAXITER; m++, m2 += 2) {
        let aa = (m * (b - m) * x) / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < EPS) d = EPS;
        c = 1 + aa / c;
        if (Math.abs(c) < EPS) c = EPS;
        d = 1 / d;
        h *= d * c;
        aa = -((a + m) * (qab + m) * x) / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < EPS) d = EPS;
        c = 1 + aa / c;
        if (Math.abs(c) < EPS) c = EPS;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < EPS) break;
      }
      return h;
    }

    function betai(a, b, x) {
      if (x < 0 || x > 1) return NaN;
      const bt = (x === 0 || x === 1) ? 0 : Math.exp(gammaln(a + b) - gammaln(a) - gammaln(b) + a * Math.log(x) + b * Math.log(1 - x));
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betacf(a, b, x) / a;
      }
      return 1 - bt * betacf(b, a, 1 - x) / b;
    }

    function fCDF(x, df1, df2) {
      const num = df1 * x;
      const den = df1 * x + df2;
      return betai(df1 / 2, df2 / 2, num / den);
    }

    function fQuantile(p, df1, df2) {
      // simple numerical search using binary method
      let low = 0;
      let high = 1000;
      for (let i = 0; i < 60; i++) {
        const mid = (low + high) / 2;
        const val = fCDF(mid, df1, df2);
        if (val < p) {
          low = mid;
        } else {
          high = mid;
        }
      }
      return (low + high) / 2;
    }

    const form = document.getElementById('htFForm');
    const resultBox = document.getElementById('htFResult');

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const tail = form.tail.value;
      const sd1 = Number(form.sd1.value);
      const sd2 = Number(form.sd2.value);
      const n1 = Number(form.n1.value);
      const n2 = Number(form.n2.value);
      const alpha = Number(form.alpha.value);

      if ([sd1, sd2].some(v => !Number.isFinite(v) || v <= 0) || [n1, n2].some(v => !Number.isFinite(v) || v < 2)) {
        resultBox.innerHTML = '<p>ตรวจสอบว่า s1, s2 > 0 และ n ≥ 2</p>';
        return;
      }

      const df1 = n1 - 1;
      const df2 = n2 - 1;
      let F = (sd1 * sd1) / (sd2 * sd2);
      let dfNum = df1;
      let dfDen = df2;
      let swapped = false;

      if (tail === 'two' && F < 1) {
        F = 1 / F;
        dfNum = df2;
        dfDen = df1;
        swapped = true;
      }

      let pValue;
      const cdf = fCDF(F, dfNum, dfDen);
      if (tail === 'two') {
        pValue = 2 * Math.min(1 - cdf, cdf);
      } else if (tail === 'right') {
        pValue = 1 - cdf;
      } else {
        pValue = fCDF(1 / F, dfDen, dfNum);
      }

      let criticalDesc;
      if (tail === 'two') {
        const upper = fQuantile(1 - alpha / 2, dfNum, dfDen);
        const lower = 1 / fQuantile(1 - alpha / 2, dfDen, dfNum);
        criticalDesc = `ปฏิเสธเมื่อ F &lt; ${lower.toFixed(3)} หรือ F &gt; ${upper.toFixed(3)}`;
      } else if (tail === 'right') {
        const upper = fQuantile(1 - alpha, dfNum, dfDen);
        criticalDesc = `ปฏิเสธเมื่อ F &gt; ${upper.toFixed(3)}`;
      } else {
        const lower = fQuantile(alpha, dfNum, dfDen);
        criticalDesc = `ปฏิเสธเมื่อ F &lt; ${lower.toFixed(3)}`;
      }

      const decision = pValue <= alpha ? 'ปฏิเสธ $H_0$' : 'ยังไม่ปฏิเสธ $H_0$';
      const note = swapped ? 'ปรับลำดับเพื่อให้ F ≥ 1 ในการทดสอบสองด้านแล้ว' : 'ใช้การวางลำดับตามป้อน';

      resultBox.innerHTML = `
        <strong>${decision}</strong>
        <p>$F = ${F.toFixed(3)}$ ที่ $df_1 = ${dfNum}$, $df_2 = ${dfDen}$</p>
        <p>${criticalDesc}</p>
        <p>$p\text{-value} = ${pValue.toFixed(4)}$</p>
        <p class="muted">${note}. ตรวจสอบว่าข้อมูลสองกลุ่มแจกแจงใกล้ปกติและสุ่มอิสระ</p>
      `;
      if (window.MathJax?.typeset) {
        MathJax.typeset([resultBox]);
      }
    });
  </script>
</body>
</html>
