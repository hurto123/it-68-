<!DOCTYPE html>
<html class="theme-light" lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ทดสอบสมมติฐานค่าเฉลี่ยประชากรเดียว พร้อมสูตร z/t, การเลือกทิศทาง และเครื่องมือคำนวณ" />
  <title>บทที่ 25 • ทดสอบค่าเฉลี่ยประชากรเดียว</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="print.css" media="print" />
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']], displayMath: [['\\[', '\\]']] },
      svg: { fontCache: 'global' },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea'] }
    };
  </script>
  <script defer src="assets/js/reading-tools.js"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #05090c;
      --surface: #101820;
      --surface-alt: #172128;
      --surface-soft: #1e2a34;
      --text: #f2f6fb;
      --muted: #9aa9bc;
      --accent: #64d8ff;
      --accent-soft: rgba(100, 216, 255, 0.2);
      --border: #23313b;
      --danger: #ff7a7a;
    }

    body { margin: 0; background: radial-gradient(circle at 12% -10%, rgba(100,216,255,0.2), transparent 58%), radial-gradient(circle at 85% 0%, rgba(255,122,122,0.16), transparent 62%), var(--bg); color: var(--text); font: 16px/1.65 'Sarabun', 'Noto Sans Thai', system-ui, sans-serif; }
    header { background: linear-gradient(135deg, rgba(18, 30, 38, 0.95), rgba(100,216,255,0.24)); border-bottom: 1px solid var(--border); box-shadow: 0 22px 55px rgba(100,216,255,0.18); }
    header .wrap,
    main,
    footer .wrap { max-width: 1080px; margin: 0 auto; padding: 1.2rem 1.35rem 1.8rem; }

    h1, h2, h3 { line-height: 1.25; margin: 0.25rem 0 0.55rem; }
    h1 { font-size: clamp(1.9rem, 4vw, 2.45rem); }
    h2 { font-size: clamp(1.35rem, 3vw, 1.85rem); }
    h3 { font-size: clamp(1.12rem, 2.6vw, 1.35rem); }

    p, ul, ol { margin: 0.45rem 0 0.7rem; }
    a { color: var(--accent); }

    main.wrap { display: grid; gap: 1.2rem; padding-bottom: 4rem; }
    section.card, article.card { background: var(--surface); border-radius: 20px; border: 1px solid rgba(255,255,255,0.08); padding: clamp(1.1rem, 1.6vw, 1.85rem); box-shadow: 0 18px 44px rgba(0,0,0,0.35); }
    .hero { background: var(--surface-alt); display: grid; gap: 0.9rem; }
    .hero p { margin: 0; color: var(--muted); }
    .eyebrow { letter-spacing: 0.16em; text-transform: uppercase; font-size: 0.75rem; color: var(--muted); }

    .calc { display: grid; gap: 0.9rem; background: var(--surface-alt); border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); padding: 1rem 1.1rem; }
    .calc label { display: grid; gap: 0.35rem; font-weight: 600; }
    .calc input, .calc select { background: rgba(12, 18, 24, 0.6); border: 1px solid var(--border); border-radius: 12px; color: var(--text); padding: 0.55rem 0.75rem; font: inherit; }
    .calc button { justify-self: start; border: none; border-radius: 12px; background: var(--accent); color: #042430; font-weight: 700; padding: 0.6rem 1.2rem; cursor: pointer; }

    .result-box { background: var(--surface-soft); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); padding: 0.9rem 1rem; }
    .result-box strong { font-size: 1.05rem; }
    .muted { color: var(--muted); font-size: 0.92rem; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <p class="eyebrow">บทที่ 25</p>
      <h1>ทดสอบค่าเฉลี่ยประชากรเดียว</h1>
      <p>เลือกใช้ $z$ หรือ $t$ ตามเงื่อนไข พร้อมเครื่องมือคำนวณ test statistic, p-value และการตัดสินใจ</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <h2>สรุปสูตร</h2>
      <ul>
        <li>Test statistic: $z = \dfrac{\bar x - \mu_0}{\sigma/\sqrt{n}}$ หากรู้ $\sigma$ หรือ $t = \dfrac{\bar x - \mu_0}{s/\sqrt{n}}$ หากไม่รู้ $\sigma$</li>
        <li>$H_0: \mu = \mu_0$ และ $H_a$ ขึ้นกับทิศทาง (มากกว่า, น้อยกว่า, หรือไม่เท่ากัน)</li>
        <li>ใช้ $t$ distribution กับ $df = n-1$ เมื่อตัวอย่างเล็กและข้อมูลใกล้ปกติ</li>
      </ul>
    </section>

    <section class="card">
      <h2>เครื่องมือคำนวณ</h2>
      <form class="calc" id="htMeanForm">
        <label>ทิศทางของ $H_a$
          <select name="tail">
            <option value="two" selected>$\mu \neq \mu_0$</option>
            <option value="right">$\mu &gt; \mu_0$</option>
            <option value="left">$\mu &lt; \mu_0$</option>
          </select>
        </label>
        <label>วิธีการ
          <select name="method">
            <option value="z">รู้ $\sigma$ (ใช้ z)</option>
            <option value="t" selected>ไม่รู้ $\sigma$ (ใช้ t)</option>
          </select>
        </label>
        <label>ค่าเฉลี่ยตัวอย่าง ($\bar x$)
          <input type="number" step="0.01" name="mean" value="68" required />
        </label>
        <label>สมมติฐาน ($\mu_0$)
          <input type="number" step="0.01" name="mu0" value="65" required />
        </label>
        <label>ส่วนเบี่ยงเบน ($\sigma$ หรือ $s$)
          <input type="number" step="0.01" min="0" name="sd" value="9.5" required />
        </label>
        <label>ขนาดตัวอย่าง ($n$)
          <input type="number" name="n" value="28" min="2" required />
        </label>
        <label>ระดับนัยสำคัญ ($\alpha$)
          <select name="alpha">
            <option value="0.10">0.10</option>
            <option value="0.05" selected>0.05</option>
            <option value="0.01">0.01</option>
          </select>
        </label>
        <button type="submit">คำนวณผล</button>
      </form>
      <div class="result-box" id="htMeanResult">
        <strong>ผลลัพธ์</strong>
        <p class="muted">ระบบจะแสดงค่า test statistic, critical value, p-value และข้อสรุป</p>
      </div>
    </section>

    <section class="card">
      <h2>เคล็ดลับ</h2>
      <ul>
        <li>ตัวอย่างเล็กควรตรวจสอบ histogram หรือ Q-Q plot เพื่อดูความใกล้ปกติ</li>
        <li>รายงาน effect size ($\bar x - \mu_0$) ควบคู่กับผลลัพธ์</li>
        <li>ระบุชัดเจนว่าการทดสอบเป็น one-sided หรือ two-sided</li>
      </ul>
    </section>
  </main>

  <script>
    const tCriticalTable = {
      1: { '0.10_two': 6.314, '0.05_two': 12.706, '0.01_two': 63.657, '0.10_right': 3.078, '0.05_right': 6.314, '0.01_right': 31.821 },
      2: { '0.10_two': 2.92, '0.05_two': 4.303, '0.01_two': 9.925, '0.10_right': 1.886, '0.05_right': 2.92, '0.01_right': 4.604 },
      3: { '0.10_two': 2.353, '0.05_two': 3.182, '0.01_two': 5.841, '0.10_right': 1.638, '0.05_right': 2.353, '0.01_right': 3.307 },
      4: { '0.10_two': 2.132, '0.05_two': 2.776, '0.01_two': 4.604, '0.10_right': 1.533, '0.05_right': 2.132, '0.01_right': 2.998 },
      5: { '0.10_two': 2.015, '0.05_two': 2.571, '0.01_two': 4.032, '0.10_right': 1.476, '0.05_right': 2.015, '0.01_right': 2.757 },
      6: { '0.10_two': 1.943, '0.05_two': 2.447, '0.01_two': 3.707, '0.10_right': 1.44, '0.05_right': 1.943, '0.01_right': 2.612 },
      7: { '0.10_two': 1.895, '0.05_two': 2.365, '0.01_two': 3.499, '0.10_right': 1.415, '0.05_right': 1.895, '0.01_right': 2.517 },
      8: { '0.10_two': 1.86, '0.05_two': 2.306, '0.01_two': 3.355, '0.10_right': 1.397, '0.05_right': 1.86, '0.01_right': 2.449 },
      9: { '0.10_two': 1.833, '0.05_two': 2.262, '0.01_two': 3.25, '0.10_right': 1.383, '0.05_right': 1.833, '0.01_right': 2.398 },
      10: { '0.10_two': 1.812, '0.05_two': 2.228, '0.01_two': 3.169, '0.10_right': 1.372, '0.05_right': 1.812, '0.01_right': 2.359 },
      12: { '0.10_two': 1.782, '0.05_two': 2.179, '0.01_two': 3.055, '0.10_right': 1.356, '0.05_right': 1.782, '0.01_right': 2.303 },
      15: { '0.10_two': 1.753, '0.05_two': 2.131, '0.01_two': 2.947, '0.10_right': 1.341, '0.05_right': 1.753, '0.01_right': 2.264 },
      20: { '0.10_two': 1.725, '0.05_two': 2.086, '0.01_two': 2.845, '0.10_right': 1.325, '0.05_right': 1.725, '0.01_right': 2.228 },
      30: { '0.10_two': 1.697, '0.05_two': 2.042, '0.01_two': 2.75, '0.10_right': 1.31, '0.05_right': 1.697, '0.01_right': 2.201 },
      60: { '0.10_two': 1.671, '0.05_two': 2, '0.01_two': 2.66, '0.10_right': 1.296, '0.05_right': 1.671, '0.01_right': 2.18 },
      Infinity: { '0.10_two': 1.6449, '0.05_two': 1.96, '0.01_two': 2.5758, '0.10_right': 1.2816, '0.05_right': 1.6449, '0.01_right': 2.3263 }
    };

    function getTCritical(df, alpha, tail) {
      const keyBase = tail === 'two' ? `${alpha}_two` : `${alpha}_${tail}`;
      const keys = Object.keys(tCriticalTable).map(Number).sort((a, b) => a - b);
      let selected = Infinity;
      for (const key of keys) {
        if (df <= key) { selected = key; break; }
      }
      return (tCriticalTable[selected] || tCriticalTable[Infinity])[keyBase];
    }

    function erf(x) {
      const sign = Math.sign(x);
      const ax = Math.abs(x);
      const t = 1 / (1 + 0.5 * ax);
      const tau = t * Math.exp(-ax * ax - 1.26551223 +
        t * (1.00002368 +
        t * (0.37409196 +
        t * (0.09678418 +
        t * (-0.18628806 +
        t * (0.27886807 +
        t * (-1.13520398 +
        t * (1.48851587 +
        t * (-0.82215223 + t * 0.17087277)))))))));
      return 1 - tau * sign;
    }

    function normCDF(x) {
      return 0.5 * (1 + erf(x / Math.SQRT2));
    }

    function gammaln(z) {
      const cof = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let x = z;
      let y = z;
      let tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < cof.length; j++) {
        ser += cof[j] / ++y;
      }
      return Math.log(2.5066282746310005 * ser / x) - tmp;
    }

    function betacf(a, b, x) {
      const MAXITER = 100;
      const EPS = 1e-8;
      let qab = a + b;
      let qap = a + 1;
      let qam = a - 1;
      let c = 1;
      let d = 1 - (qab * x) / qap;
      if (Math.abs(d) < EPS) d = EPS;
      d = 1 / d;
      let h = d;
      for (let m = 1, m2 = 2; m <= MAXITER; m++, m2 += 2) {
        let aa = (m * (b - m) * x) / ((qam + m2) * (a + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < EPS) d = EPS;
        c = 1 + aa / c;
        if (Math.abs(c) < EPS) c = EPS;
        d = 1 / d;
        h *= d * c;
        aa = -((a + m) * (qab + m) * x) / ((a + m2) * (qap + m2));
        d = 1 + aa * d;
        if (Math.abs(d) < EPS) d = EPS;
        c = 1 + aa / c;
        if (Math.abs(c) < EPS) c = EPS;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < EPS) break;
      }
      return h;
    }

    function betai(a, b, x) {
      if (x < 0 || x > 1) return NaN;
      const bt = (x === 0 || x === 1) ? 0 : Math.exp(gammaln(a + b) - gammaln(a) - gammaln(b) + a * Math.log(x) + b * Math.log(1 - x));
      if (x < (a + 1) / (a + b + 2)) {
        return bt * betacf(a, b, x) / a;
      }
      return 1 - bt * betacf(b, a, 1 - x) / b;
    }

    function tCDF(t, df) {
      const x = df / (df + t * t);
      const ib = betai(df / 2, 0.5, x);
      if (t >= 0) {
        return 1 - 0.5 * ib;
      }
      return 0.5 * ib;
    }

    const form = document.getElementById('htMeanForm');
    const resultBox = document.getElementById('htMeanResult');

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const tail = form.tail.value;
      const method = form.method.value;
      const mean = Number(form.mean.value);
      const mu0 = Number(form.mu0.value);
      const sd = Number(form.sd.value);
      const n = Number(form.n.value);
      const alpha = form.alpha.value;

      if (!Number.isFinite(sd) || sd <= 0 || !Number.isFinite(n) || n < 2) {
        resultBox.innerHTML = '<p>ตรวจสอบว่า s/σ &gt; 0 และ n ≥ 2</p>';
        return;
      }

      const se = sd / Math.sqrt(n);
      const statistic = (mean - mu0) / se;
      let pValue;
      let critical;

      if (method === 'z' || n >= 60) {
        if (tail === 'two') {
          pValue = 2 * (1 - normCDF(Math.abs(statistic)));
          critical = zCritical(`${alpha}_${tail}`);
        } else if (tail === 'right') {
          pValue = 1 - normCDF(statistic);
          critical = zCritical(`${alpha}_${tail}`);
        } else {
          pValue = normCDF(statistic);
          critical = zCritical(`${alpha}_${tail}`);
        }
      } else {
        const df = n - 1;
        const key = `${alpha}_${tail}`;
        critical = getTCritical(df, alpha, tail);
        let cdf;
        if (tail === 'two') {
          cdf = tCDF(Math.abs(statistic), df);
          pValue = 2 * (1 - cdf);
        } else if (tail === 'right') {
          cdf = tCDF(statistic, df);
          pValue = 1 - cdf;
        } else {
          cdf = tCDF(statistic, df);
          pValue = cdf;
        }
      }

      function zCritical(key) {
        const mapping = {
          '0.10_two': 1.6449,
          '0.05_two': 1.96,
          '0.01_two': 2.5758,
          '0.10_right': 1.2816,
          '0.05_right': 1.6449,
          '0.01_right': 2.3263,
          '0.10_left': -1.2816,
          '0.05_left': -1.6449,
          '0.01_left': -2.3263
        };
        return mapping[key];
      }

      const reject = pValue <= Number(alpha);
      const decision = reject ? 'ปฏิเสธ $H_0$' : 'ยังไม่ปฏิเสธ $H_0$';

      resultBox.innerHTML = `
        <strong>${decision}</strong>
        <p>$\text{Statistic} = ${statistic.toFixed(3)}$, $SE = ${se.toFixed(3)}$</p>
        <p>Critical = ${critical ? critical.toFixed(3) : 'n/a'}, $p\text{-value} = ${pValue.toFixed(4)}$</p>
        <p class="muted">หาก $p$ เล็กกว่า $\alpha$ ให้ปฏิเสธสมมติฐานศูนย์และสรุปตามทิศทางของ $H_a$</p>
      `;
      if (window.MathJax?.typeset) {
        MathJax.typeset([resultBox]);
      }
    });
  </script>
</body>
</html>
