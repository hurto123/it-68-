<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>บทที่ 25 • การทดสอบสมมติฐานค่าเฉลี่ยประชากรเดียว</title>
  <meta name="description" content="สรุปขั้นตอนทดสอบค่าเฉลี่ยประชากรเดียว (Z-test และ t-test) พร้อมตัวอย่างน้ำหนักขนมปังและห้องทดลองคำนวณผลการทดสอบ" />
  <link rel="stylesheet" href="assets/lesson-theme.css" />
</head>
<body>
  <main class="page">
    <header class="hero">
      <span class="badge">บทเรียนที่ 25</span>
      <h1>การทดสอบสมมติฐานค่าเฉลี่ยประชากรเดียว (μ)</h1>
      <p class="lead">
        กลับมาใช้ Z และ t ในโหมด “พิพากษา” — เลือกเครื่องมือให้ถูกตามเงื่อนไข แล้วตีความผลลัพธ์ด้วยภาษาคนธรรมดา
      </p>
      <div class="stat-grid">
        <div class="stat"><span class="label">รู้ σ?</span><span class="value">ใช้ Z-test</span></div>
        <div class="stat"><span class="label">ไม่รู้ σ, n เล็ก</span><span class="value">ใช้ t-test</span></div>
        <div class="stat"><span class="label">ค่าสถิติ</span><span class="value">( &bar;x − μ₀ ) / (SE)</span></div>
      </div>
    </header>

    <section class="card">
      <h2>1. สูตรสำเร็จ 5 ขั้นตอน</h2>
      <ol>
        <li>ตั้ง H₀, H₁</li>
        <li>เลือกระดับนัยสำคัญ α</li>
        <li>คำนวณค่าสถิติทดสอบ (Z หรือ t)</li>
        <li>ตัดสินด้วยวิธีค่าวิกฤตหรือ p-value</li>
        <li>สรุปผลในบริบทของโจทย์</li>
      </ol>
    </section>

    <section class="card">
      <h2>2. สถานการณ์ที่ 1: รู้ σ หรือ n ใหญ่ (Z-test)</h2>
      <p>Z<sub>test</sub> = (&bar;x − μ₀)/(σ/√n)</p>
    </section>

    <section class="card">
      <h2>3. สถานการณ์ที่ 2: ไม่รู้ σ และ n เล็ก (t-test)</h2>
      <p>t<sub>test</sub> = (&bar;x − μ₀)/(s/√n) ใช้ t-distribution กับ df = n − 1</p>
    </section>

    <section class="card">
      <h2>4. ตัวอย่าง: น้ำหนักขนมปัง</h2>
      <p>H₀: μ = 500 กรัม, H₁: μ &lt; 500 กรัม, α = 0.05, &bar;x = 495, s = 8, n = 16</p>
      <p>t<sub>test</sub> = −2.5, t<sub>0.05,15</sub> = −1.753 → ตกในพื้นที่ปฏิเสธ &rarr; ปฏิเสธ H₀</p>
      <div class="callout">ตีความ: มีหลักฐานว่าขนมปังน้ำหนักน้อยกว่าที่อ้าง</div>
    </section>

    <section class="card">
      <h2>ห้องทดลอง: คำนวณผลการทดสอบ</h2>
      <div class="playground">
        <form id="ht-mean-form">
          <div class="control-group inline">
            <label>
              <span>เลือกเครื่องมือ</span>
              <select name="method">
                <option value="z">Z-test (รู้ σ หรือ n ≥ 30)</option>
                <option value="t" selected>t-test (ไม่รู้ σ, n เล็ก)</option>
              </select>
            </label>
            <label>
              <span>เลือกทิศทาง</span>
              <select name="tail">
                <option value="two">สองหาง</option>
                <option value="right">หางขวา</option>
                <option value="left" selected>หางซ้าย</option>
              </select>
            </label>
            <label>
              <span>ระดับนัยสำคัญ α</span>
              <input type="number" name="alpha" value="0.05" step="0.005" min="0.001" max="0.2" />
            </label>
          </div>
          <div class="control-group inline">
            <label><span>&bar;x</span><input type="number" name="mean" value="495" step="0.1" /></label>
            <label><span>μ₀</span><input type="number" name="mu0" value="500" step="0.1" /></label>
            <label><span>σ หรือ s</span><input type="number" name="sd" value="8" step="0.1" min="0.0001" /></label>
            <label><span>n</span><input type="number" name="n" value="16" min="2" step="1" /></label>
          </div>
        </form>
        <div class="result-board">
          <strong id="ht-mean-summary"></strong>
          <div class="stat-grid" id="ht-mean-stats"></div>
          <p class="note" id="ht-mean-note"></p>
        </div>
      </div>
    </section>
  </main>

  <script src="assets/lesson-tools.js"></script>
  <script>
    const {
      formatNumber,
      formatPercent,
      normInv,
      normCdf,
      tInv
    } = window.LessonTools;

    const form = document.getElementById('ht-mean-form');
    const summaryEl = document.getElementById('ht-mean-summary');
    const statsEl = document.getElementById('ht-mean-stats');
    const noteEl = document.getElementById('ht-mean-note');

    function updateTest() {
      const method = form.elements['method'].value;
      const tail = form.elements['tail'].value;
      const alpha = Math.min(0.5, Math.max(0.0001, parseFloat(form.elements['alpha'].value)));
      const mean = parseFloat(form.elements['mean'].value) || 0;
      const mu0 = parseFloat(form.elements['mu0'].value) || 0;
      const sd = Math.max(0.0001, parseFloat(form.elements['sd'].value));
      const n = Math.max(2, parseFloat(form.elements['n'].value));
      const se = sd / Math.sqrt(n);
      const testStat = (mean - mu0) / se;

      let criticalText = '';
      let reject = false;
      let pValue = 0;
      let df = n - 1;

      if (method === 'z') {
        if (tail === 'two') {
          const critical = normInv(1 - alpha / 2);
          criticalText = `±${formatNumber(critical, 3)}`;
          reject = Math.abs(testStat) > critical;
          pValue = 2 * (1 - normCdf(Math.abs(testStat)));
        } else if (tail === 'right') {
          const critical = normInv(1 - alpha);
          criticalText = formatNumber(critical, 3);
          reject = testStat > critical;
          pValue = 1 - normCdf(testStat);
        } else {
          const critical = normInv(alpha);
          criticalText = formatNumber(critical, 3);
          reject = testStat < critical;
          pValue = normCdf(testStat);
        }
      } else {
        const tailProb = tail === 'two' ? 1 - alpha / 2 : (tail === 'right' ? 1 - alpha : alpha);
        const critical = tInv(tailProb, df);
        if (tail === 'two') {
          criticalText = `±${formatNumber(Math.abs(critical), 3)}`;
          reject = Math.abs(testStat) > Math.abs(critical);
          const tCdf = normCdf(Math.abs(testStat));
          // Approximate p-value using normal for simplicity
          pValue = 2 * (1 - tCdf);
        } else if (tail === 'right') {
          criticalText = formatNumber(critical, 3);
          reject = testStat > critical;
          pValue = 1 - normCdf(testStat);
        } else {
          criticalText = formatNumber(-Math.abs(critical), 3);
          reject = testStat < -Math.abs(critical);
          pValue = normCdf(testStat);
        }
      }

      summaryEl.textContent = reject ? 'คำตัดสิน: ปฏิเสธ H₀' : 'คำตัดสิน: ยังไม่ปฏิเสธ H₀';

      statsEl.innerHTML = '';
      const stats = [
        { label: method === 'z' ? 'Z-test' : 't-test', value: formatNumber(testStat, 3) },
        { label: 'Critical', value: criticalText },
        { label: 'p-value (ประมาณ)', value: formatNumber(pValue, 4) },
        { label: 'α', value: formatPercent(alpha, 2) }
      ];
      if (method === 't') {
        stats.push({ label: 'df', value: formatNumber(df, 0) });
      }
      stats.forEach(stat => {
        const div = document.createElement('div');
        div.className = 'stat';
        div.innerHTML = `<span class="label">${stat.label}</span><span class="value">${stat.value}</span>`;
        statsEl.appendChild(div);
      });

      noteEl.textContent = method === 'z'
        ? 'Z-test ใช้ได้ดีเมื่อรู้ σ หรือ n ใหญ่'
        : 't-test ควรใช้เมื่อไม่รู้ σ และ n เล็ก (p-value ประมาณด้วยการแจกแจงปกติ)';
    }

    form.addEventListener('input', updateTest);
    form.addEventListener('change', updateTest);
    updateTest();
  </script>
</body>
</html>
