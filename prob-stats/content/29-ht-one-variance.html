<!DOCTYPE html>
<html class="theme-light" lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ทดสอบความแปรปรวนประชากรเดียวด้วยไคสแควร์ พร้อมคำนวณ p-value" />
  <title>บทที่ 29 • ทดสอบความแปรปรวนประชากรเดียว</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="print.css" media="print" />
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']], displayMath: [['\\[', '\\]']] },
      svg: { fontCache: 'global' },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea'] }
    };
  </script>
  <script defer src="assets/js/reading-tools.js"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #0a0610;
      --surface: #1a1425;
      --surface-alt: #221b33;
      --surface-soft: #2a2342;
      --text: #f3f1ff;
      --muted: #a69fc2;
      --accent: #ffb56a;
      --accent-soft: rgba(255, 181, 106, 0.2);
      --border: #32294c;
    }

    body { margin: 0; background: radial-gradient(circle at 15% -12%, rgba(255,181,106,0.22), transparent 58%), radial-gradient(circle at 90% 0%, rgba(140, 124, 255, 0.16), transparent 60%), var(--bg); color: var(--text); font: 16px/1.65 'Sarabun', 'Noto Sans Thai', system-ui, sans-serif; }
    header { background: linear-gradient(135deg, rgba(34, 27, 51, 0.94), rgba(255,181,106,0.24)); border-bottom: 1px solid var(--border); box-shadow: 0 22px 55px rgba(255,181,106,0.18); }
    header .wrap,
    main,
    footer .wrap { max-width: 1080px; margin: 0 auto; padding: 1.2rem 1.35rem 1.8rem; }

    h1, h2, h3 { line-height: 1.25; margin: 0.25rem 0 0.55rem; }
    h1 { font-size: clamp(1.9rem, 4vw, 2.45rem); }
    h2 { font-size: clamp(1.35rem, 3vw, 1.85rem); }
    h3 { font-size: clamp(1.12rem, 2.6vw, 1.35rem); }

    p, ul, ol { margin: 0.45rem 0 0.7rem; }
    a { color: var(--accent); }

    main.wrap { display: grid; gap: 1.2rem; padding-bottom: 4rem; }
    section.card, article.card { background: var(--surface); border-radius: 20px; border: 1px solid rgba(255,255,255,0.08); padding: clamp(1.1rem, 1.6vw, 1.85rem); box-shadow: 0 18px 44px rgba(0,0,0,0.35); }
    .hero { background: var(--surface-alt); display: grid; gap: 0.9rem; }
    .hero p { margin: 0; color: var(--muted); }
    .eyebrow { letter-spacing: 0.16em; text-transform: uppercase; font-size: 0.75rem; color: var(--muted); }

    .calc { display: grid; gap: 0.9rem; background: var(--surface-alt); border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); padding: 1rem 1.1rem; }
    .calc label { display: grid; gap: 0.35rem; font-weight: 600; }
    .calc input, .calc select { background: rgba(18, 12, 32, 0.6); border: 1px solid var(--border); border-radius: 12px; color: var(--text); padding: 0.55rem 0.75rem; font: inherit; }
    .calc button { justify-self: start; border: none; border-radius: 12px; background: var(--accent); color: #2d1406; font-weight: 700; padding: 0.6rem 1.2rem; cursor: pointer; }

    .result-box { background: var(--surface-soft); border-radius: 16px; border: 1px solid rgba(255,255,255,0.08); padding: 0.9rem 1rem; }
    .result-box strong { font-size: 1.05rem; }
    .muted { color: var(--muted); font-size: 0.92rem; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <p class="eyebrow">บทที่ 29</p>
      <h1>ทดสอบความแปรปรวนประชากรเดียว</h1>
      <p>ใช้สถิติไคสแควร์ในการตรวจสอบว่า $\sigma^2$ แตกต่างจากค่าอ้างอิงหรือไม่</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <h2>สูตร</h2>
      <p>$\chi^2 = \dfrac{(n-1)S^2}{\sigma_0^2}$ โดย $H_0: \sigma^2 = \sigma_0^2$</p>
      <p>เปรียบเทียบกับการแจกแจงไคสแควร์ที่ $df = n-1$</p>
    </section>

    <section class="card">
      <h2>เครื่องมือคำนวณ</h2>
      <form class="calc" id="htVarForm">
        <label>ทิศทางของ $H_a$
          <select name="tail">
            <option value="two" selected>สองด้าน</option>
            <option value="right">$\sigma^2 &gt; \sigma_0^2$</option>
            <option value="left">$\sigma^2 &lt; \sigma_0^2$</option>
          </select>
        </label>
        <label>ส่วนเบี่ยงเบนมาตรฐานตัวอย่าง ($s$)
          <input type="number" step="0.01" name="sd" value="5.4" min="0" required />
        </label>
        <label>ค่าภายใต้ $H_0$ ($\sigma_0$)
          <input type="number" step="0.01" name="sigma0" value="4.5" min="0" required />
        </label>
        <label>ขนาดตัวอย่าง ($n$)
          <input type="number" name="n" value="22" min="3" required />
        </label>
        <label>ระดับนัยสำคัญ ($\alpha$)
          <select name="alpha">
            <option value="0.10">0.10</option>
            <option value="0.05" selected>0.05</option>
            <option value="0.01">0.01</option>
          </select>
        </label>
        <button type="submit">คำนวณผล</button>
      </form>
      <div class="result-box" id="htVarResult">
        <strong>ผลลัพธ์</strong>
        <p class="muted">จะแสดงค่า $\chi^2$, p-value และขอบเขตวิกฤตโดยประมาณ</p>
      </div>
    </section>
  </main>

  <script>
    function gammaln(z) {
      const cof = [76.18009172947146, -86.50532032941677, 24.01409824083091,
        -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5];
      let x = z;
      let y = z;
      let tmp = x + 5.5;
      tmp -= (x + 0.5) * Math.log(tmp);
      let ser = 1.000000000190015;
      for (let j = 0; j < cof.length; j++) {
        ser += cof[j] / ++y;
      }
      return Math.log(2.5066282746310005 * ser / x) - tmp;
    }

    function gser(a, x) {
      const ITMAX = 100;
      const EPS = 1e-8;
      let sum = 1 / a;
      let del = sum;
      let ap = a;
      for (let n = 1; n <= ITMAX; n++) {
        ap += 1;
        del *= x / ap;
        sum += del;
        if (Math.abs(del) < Math.abs(sum) * EPS) {
          return sum * Math.exp(-x + a * Math.log(x) - gammaln(a));
        }
      }
      return sum * Math.exp(-x + a * Math.log(x) - gammaln(a));
    }

    function gcf(a, x) {
      const ITMAX = 100;
      const EPS = 1e-8;
      const FPMIN = 1e-30;
      let b = x + 1 - a;
      let c = 1 / FPMIN;
      let d = 1 / b;
      let h = d;
      for (let i = 1; i <= ITMAX; i++) {
        const an = -i * (i - a);
        b += 2;
        d = an * d + b;
        if (Math.abs(d) < FPMIN) d = FPMIN;
        c = b + an / c;
        if (Math.abs(c) < FPMIN) c = FPMIN;
        d = 1 / d;
        const del = d * c;
        h *= del;
        if (Math.abs(del - 1) < EPS) break;
      }
      return Math.exp(-x + a * Math.log(x) - gammaln(a)) * h;
    }

    function gammp(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 0;
      if (x < a + 1) {
        return gser(a, x);
      }
      return 1 - gcf(a, x);
    }

    function gammq(a, x) {
      if (x < 0 || a <= 0) return NaN;
      if (x === 0) return 1;
      if (x < a + 1) {
        return 1 - gser(a, x);
      }
      return gcf(a, x);
    }

    function chiCDF(x, df) {
      return gammp(df / 2, x / 2);
    }

    function chiQuantile(p, df) {
      const z = normInv(p);
      const term = 2 / (9 * df);
      return df * Math.pow(1 - term + z * Math.sqrt(term), 3);
    }

    function normInv(p) {
      if (p <= 0 || p >= 1) throw new Error('p must be (0,1)');
      const a1 = -39.69683028665376;
      const a2 = 220.9460984245205;
      const a3 = -275.9285104469687;
      const a4 = 138.3577518672690;
      const a5 = -30.66479806614716;
      const a6 = 2.506628277459239;
      const b1 = -54.47609879822406;
      const b2 = 161.5858368580409;
      const b3 = -155.6989798598866;
      const b4 = 66.80131188771972;
      const b5 = -13.28068155288572;
      const c1 = -0.007784894002430293;
      const c2 = -0.3223964580411365;
      const c3 = -2.400758277161838;
      const c4 = -2.549732539343734;
      const c5 = 4.374664141464968;
      const c6 = 2.938163982698783;
      const d1 = 0.007784695709041462;
      const d2 = 0.3224671290700398;
      const d3 = 2.445134137142996;
      const d4 = 3.754408661907416;
      const plow = 0.02425;
      const phigh = 1 - plow;
      let q, r;
      if (p < plow) {
        q = Math.sqrt(-2 * Math.log(p));
        return (((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
               ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
      }
      if (p > phigh) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        return -(((((c1 * q + c2) * q + c3) * q + c4) * q + c5) * q + c6) /
                ((((d1 * q + d2) * q + d3) * q + d4) * q + 1);
      }
      q = p - 0.5;
      r = q * q;
      return (((((a1 * r + a2) * r + a3) * r + a4) * r + a5) * r + a6) * q /
             (((((b1 * r + b2) * r + b3) * r + b4) * r + b5) * r + 1);
    }

    const form = document.getElementById('htVarForm');
    const resultBox = document.getElementById('htVarResult');

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      const tail = form.tail.value;
      const sd = Number(form.sd.value);
      const sigma0 = Number(form.sigma0.value);
      const n = Number(form.n.value);
      const alpha = form.alpha.value;

      if (!Number.isFinite(sd) || sd <= 0 || !Number.isFinite(sigma0) || sigma0 <= 0 || !Number.isFinite(n) || n < 3) {
        resultBox.innerHTML = '<p>กรอกข้อมูลให้ถูกต้อง (s, σ₀ > 0 และ n ≥ 3)</p>';
        return;
      }

      const df = n - 1;
      const sampleVar = sd * sd;
      const stat = (df * sampleVar) / (sigma0 * sigma0);
      let pValue;
      if (tail === 'two') {
        const upper = 1 - chiCDF(stat, df);
        const lower = chiCDF(stat, df);
        pValue = 2 * Math.min(upper, lower);
      } else if (tail === 'right') {
        pValue = 1 - chiCDF(stat, df);
      } else {
        pValue = chiCDF(stat, df);
      }

      const alphaNum = Number(alpha);
      let criticalDesc;
      if (tail === 'two') {
        const chiUpper = chiQuantile(1 - alphaNum / 2, df);
        const chiLower = chiQuantile(alphaNum / 2, df);
        criticalDesc = `ช่วงปฏิเสธ: (0, ${chiLower.toFixed(3)}) ∪ (${chiUpper.toFixed(3)}, ∞)`;
      } else if (tail === 'right') {
        const chiUpper = chiQuantile(1 - alphaNum, df);
        criticalDesc = `ปฏิเสธเมื่อ $\chi^2 &gt; ${chiUpper.toFixed(3)}$`;
      } else {
        const chiLower = chiQuantile(alphaNum, df);
        criticalDesc = `ปฏิเสธเมื่อ $\chi^2 &lt; ${chiLower.toFixed(3)}$`;
      }

      const reject = pValue <= alphaNum;
      const decision = reject ? 'ปฏิเสธ $H_0$' : 'ยังไม่ปฏิเสธ $H_0$';

      resultBox.innerHTML = `
        <strong>${decision}</strong>
        <p>$\chi^2 = ${stat.toFixed(3)}$ ที่ $df = ${df}$</p>
        <p>${criticalDesc}</p>
        <p>$p\text{-value} = ${pValue.toFixed(4)}$</p>
        <p class="muted">ใช้เมื่อข้อมูลมาจากประชากรใกล้เคียงปกติ หากเบ้มากควรใช้วิธี bootstrap</p>
      `;
      if (window.MathJax?.typeset) {
        MathJax.typeset([resultBox]);
      }
    });
  </script>
</body>
</html>
