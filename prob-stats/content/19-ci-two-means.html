<!DOCTYPE html>
<html class="theme-light" lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="ช่วงความเชื่อมั่นสำหรับผลต่างค่าเฉลี่ยสองประชากร พร้อมตัวเลือก equal variance หรือ Welch และตัวอย่างการตีความ" />
  <title>บทที่ 19 • ช่วงความเชื่อมั่นผลต่างค่าเฉลี่ย</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="print.css" media="print" />
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']], displayMath: [['\\[', '\\]']] },
      svg: { fontCache: 'global' },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea'] }
    };
  </script>
  <script defer src="assets/js/reading-tools.js"></script>
  <style>
    :root {
      color-scheme: dark;
      --bg: #040d0f;
      --surface: #0d181f;
      --surface-alt: #12212b;
      --surface-soft: #192b36;
      --text: #f1f8ff;
      --muted: #95abc2;
      --accent: #7fffd4;
      --accent-soft: rgba(127, 255, 212, 0.2);
      --border: #1a2c35;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at 10% -15%, rgba(127,255,212,0.18), transparent 62%),
                  radial-gradient(circle at 90% 0%, rgba(111, 174, 255, 0.18), transparent 60%),
                  var(--bg);
      color: var(--text);
      font: 16px/1.65 'Sarabun', 'Noto Sans Thai', system-ui, sans-serif;
    }

    header { background: linear-gradient(135deg, rgba(18, 33, 43, 0.95), rgba(127,255,212,0.22)); border-bottom: 1px solid var(--border); box-shadow: 0 22px 55px rgba(127,255,212,0.16); }
    header .wrap,
    main,
    footer .wrap { max-width: 1080px; margin: 0 auto; padding: 1.2rem 1.35rem 1.8rem; }

    h1, h2, h3 { line-height: 1.25; margin: 0.25rem 0 0.55rem; }
    h1 { font-size: clamp(1.9rem, 4vw, 2.45rem); }
    h2 { font-size: clamp(1.35rem, 3vw, 1.85rem); }
    h3 { font-size: clamp(1.12rem, 2.6vw, 1.38rem); }

    p, ul, ol { margin: 0.45rem 0 0.7rem; }
    a { color: var(--accent); }

    main.wrap { display: grid; gap: 1.2rem; padding-bottom: 4rem; }

    section.card, article.card { background: var(--surface); border-radius: 20px; border: 1px solid rgba(255,255,255,0.08); padding: clamp(1.1rem, 1.6vw, 1.85rem); box-shadow: 0 18px 42px rgba(0, 0, 0, 0.35); }
    .hero { background: var(--surface-alt); display: grid; gap: 0.9rem; }
    .hero p { margin: 0; color: var(--muted); }
    .eyebrow { letter-spacing: 0.16em; text-transform: uppercase; font-size: 0.75rem; color: var(--muted); }

    .pill-row { display: flex; flex-wrap: wrap; gap: 0.55rem; }
    .pill { display: inline-flex; gap: 0.35rem; padding: 0.45rem 0.85rem; border-radius: 999px; border: 1px solid rgba(255,255,255,0.08); background: rgba(10,22,27,0.7); font-size: 0.88rem; color: var(--text); }

    .grid { display: grid; gap: 1rem; }
    @media (min-width: 900px) { .grid.two { grid-template-columns: repeat(2, minmax(0, 1fr)); } }

    .calc { display: grid; gap: 0.9rem; background: var(--surface-alt); border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); padding: 1rem 1.1rem; }
    .calc label { display: grid; gap: 0.35rem; font-weight: 600; }
    .calc input, .calc select { background: rgba(6, 12, 18, 0.55); border: 1px solid var(--border); border-radius: 12px; color: var(--text); padding: 0.55rem 0.75rem; font: inherit; }
    .calc button { justify-self: start; border: none; border-radius: 12px; background: var(--accent); color: #0a1b1a; font-weight: 700; padding: 0.6rem 1.2rem; cursor: pointer; }

    .result-box { background: var(--surface-soft); border-radius: 16px; border: 1px solid rgba(255,255,255,0.06); padding: 0.9rem 1rem; }
    .result-box strong { font-size: 1.05rem; }
    .muted { color: var(--muted); font-size: 0.92rem; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <p class="eyebrow">บทที่ 19</p>
      <h1>ช่วงความเชื่อมั่นผลต่างค่าเฉลี่ยสองประชากร</h1>
      <p>วิเคราะห์ $\mu_1 - \mu_2$ ทั้งกรณีความแปรปรวนเท่ากันและไม่เท่ากัน พร้อมเครื่องมือช่วยคำนวณ</p>
      <div class="pill-row">
        <span class="pill">สุ่มอิสระจากแต่ละประชากร</span>
        <span class="pill">เลือกใช้ $t$ distribution เมื่อไม่รู้ $\sigma$</span>
        <span class="pill">Welch ลดข้อจำกัด equal variance</span>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card hero">
      <h2>ภาพรวม</h2>
      <p>เราสนใจช่วงสำหรับ $\Delta = \mu_1 - \mu_2$. ตัวประมาณจุดคือ $\bar x_1 - \bar x_2$ และ $SE$ ขึ้นกับสมมติฐานเรื่องความแปรปรวน</p>
      <ul>
        <li>Equal variance: ใช้ส่วนเบี่ยงเบนร่วม $s_p$</li>
        <li>Unequal variance (Welch): ใช้ $SE = \sqrt{\dfrac{s_1^2}{n_1} + \dfrac{s_2^2}{n_2}}$</li>
        <li>เลือก $t_{\alpha/2,\,df}$ ที่ได้จากกฎ pooled หรือ Welch</li>
      </ul>
    </section>

    <section class="card grid two">
      <article>
        <h3>Equal variance (pooled)</h3>
        <p>$s_p^2 = \dfrac{(n_1-1)s_1^2 + (n_2-1)s_2^2}{n_1 + n_2 -2}$ และ $SE = s_p \sqrt{\dfrac{1}{n_1} + \dfrac{1}{n_2}}$</p>
        <p>$df = n_1 + n_2 - 2$</p>
      </article>
      <article>
        <h3>Welch (unequal variance)</h3>
        <p>$SE = \sqrt{\dfrac{s_1^2}{n_1} + \dfrac{s_2^2}{n_2}}$</p>
        <p>$df = \dfrac{(\dfrac{s_1^2}{n_1} + \dfrac{s_2^2}{n_2})^2}{\dfrac{(s_1^2/n_1)^2}{n_1-1} + \dfrac{(s_2^2/n_2)^2}{n_2-1}}$ (ปัดลง)</p>
      </article>
    </section>

    <section class="card">
      <h2>ทดลองคำนวณ</h2>
      <form class="calc" id="ciDiffMeanForm">
        <label>สมมติฐาน
          <select name="method">
            <option value="equal">Equal variance (pooled)</option>
            <option value="welch" selected>Welch (unequal)</option>
          </select>
        </label>
        <label>ค่าเฉลี่ยกลุ่ม 1 ($\bar x_1$)
          <input type="number" step="0.01" name="mean1" value="68" required />
        </label>
        <label>ค่าเฉลี่ยกลุ่ม 2 ($\bar x_2$)
          <input type="number" step="0.01" name="mean2" value="64" required />
        </label>
        <label>ส่วนเบี่ยงเบนกลุ่ม 1 ($s_1$)
          <input type="number" step="0.01" min="0" name="sd1" value="11" required />
        </label>
        <label>ส่วนเบี่ยงเบนกลุ่ม 2 ($s_2$)
          <input type="number" step="0.01" min="0" name="sd2" value="9" required />
        </label>
        <label>ขนาดตัวอย่าง $n_1$
          <input type="number" name="n1" value="35" min="2" required />
        </label>
        <label>ขนาดตัวอย่าง $n_2$
          <input type="number" name="n2" value="30" min="2" required />
        </label>
        <label>ระดับความเชื่อมั่น
          <select name="conf">
            <option value="0.80">80%</option>
            <option value="0.90">90%</option>
            <option value="0.95" selected>95%</option>
            <option value="0.99">99%</option>
          </select>
        </label>
        <button type="submit">คำนวณช่วง</button>
      </form>
      <div class="result-box" id="ciDiffMeanResult">
        <strong>เริ่มทดลองคำนวณได้เลย</strong>
        <p class="muted">ผลต่างค่าเฉลี่ย (กลุ่ม1 - กลุ่ม2) จะรายงานพร้อม $SE$, ตัวคูณ $t$, และช่วง</p>
      </div>
    </section>

    <section class="card">
      <h2>เคล็ดลับการตีความ</h2>
      <ul>
        <li>บอกทิศทาง: “กลุ่มทดลองมากกว่ากลุ่มควบคุม 2.3 หน่วย (95% CI 0.7 ถึง 3.9)”</li>
        <li>ตรวจสอบ $df$ ของ Welch หากต่ำกว่า 1 ให้เพิ่มขนาดตัวอย่าง</li>
        <li>หากข้อมูลจับคู่ ให้ใช้วิธี paired (บทต่อไปของการทดสอบสมมติฐาน)</li>
      </ul>
    </section>
  </main>

  <script>
    const zCritical = {
      '0.80': 1.2816,
      '0.90': 1.6449,
      '0.95': 1.96,
      '0.99': 2.5758
    };

    const tCriticalTable = {
      1: { '0.80': 3.078, '0.90': 6.314, '0.95': 12.706, '0.99': 63.657 },
      2: { '0.80': 1.886, '0.90': 2.92, '0.95': 4.303, '0.99': 9.925 },
      3: { '0.80': 1.638, '0.90': 2.353, '0.95': 3.182, '0.99': 5.841 },
      4: { '0.80': 1.533, '0.90': 2.132, '0.95': 2.776, '0.99': 4.604 },
      5: { '0.80': 1.476, '0.90': 2.015, '0.95': 2.571, '0.99': 4.032 },
      6: { '0.80': 1.44, '0.90': 1.943, '0.95': 2.447, '0.99': 3.707 },
      7: { '0.80': 1.415, '0.90': 1.895, '0.95': 2.365, '0.99': 3.499 },
      8: { '0.80': 1.397, '0.90': 1.86, '0.95': 2.306, '0.99': 3.355 },
      9: { '0.80': 1.383, '0.90': 1.833, '0.95': 2.262, '0.99': 3.25 },
      10: { '0.80': 1.372, '0.90': 1.812, '0.95': 2.228, '0.99': 3.169 },
      11: { '0.80': 1.363, '0.90': 1.796, '0.95': 2.201, '0.99': 3.106 },
      12: { '0.80': 1.356, '0.90': 1.782, '0.95': 2.179, '0.99': 3.055 },
      13: { '0.80': 1.35, '0.90': 1.771, '0.95': 2.16, '0.99': 3.012 },
      14: { '0.80': 1.345, '0.90': 1.761, '0.95': 2.145, '0.99': 2.977 },
      15: { '0.80': 1.341, '0.90': 1.753, '0.95': 2.131, '0.99': 2.947 },
      16: { '0.80': 1.337, '0.90': 1.746, '0.95': 2.12, '0.99': 2.921 },
      17: { '0.80': 1.333, '0.90': 1.74, '0.95': 2.11, '0.99': 2.898 },
      18: { '0.80': 1.33, '0.90': 1.734, '0.95': 2.101, '0.99': 2.878 },
      19: { '0.80': 1.328, '0.90': 1.729, '0.95': 2.093, '0.99': 2.861 },
      20: { '0.80': 1.325, '0.90': 1.725, '0.95': 2.086, '0.99': 2.845 },
      25: { '0.80': 1.316, '0.90': 1.708, '0.95': 2.06, '0.99': 2.787 },
      30: { '0.80': 1.31, '0.90': 1.697, '0.95': 2.042, '0.99': 2.75 },
      40: { '0.80': 1.303, '0.90': 1.684, '0.95': 2.021, '0.99': 2.704 },
      60: { '0.80': 1.296, '0.90': 1.671, '0.95': 2, '0.99': 2.66 },
      120: { '0.80': 1.289, '0.90': 1.658, '0.95': 1.98, '0.99': 2.617 },
      Infinity: { '0.80': 1.282, '0.90': 1.645, '0.95': 1.96, '0.99': 2.576 }
    };

    function getTCritical(df, conf) {
      if (!Number.isFinite(df) || df <= 0) return tCriticalTable[Infinity][conf];
      const keys = Object.keys(tCriticalTable).map(Number).sort((a, b) => a - b);
      let selected = Infinity;
      for (const key of keys) {
        if (df <= key) {
          selected = key;
          break;
        }
      }
      return (tCriticalTable[selected] || tCriticalTable[Infinity])[conf];
    }

    const ciDiffMeanForm = document.getElementById('ciDiffMeanForm');
    const ciDiffMeanResult = document.getElementById('ciDiffMeanResult');

    ciDiffMeanForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const form = new FormData(ciDiffMeanForm);
      const method = form.get('method');
      const mean1 = Number(form.get('mean1'));
      const mean2 = Number(form.get('mean2'));
      const sd1 = Number(form.get('sd1'));
      const sd2 = Number(form.get('sd2'));
      const n1 = Number(form.get('n1'));
      const n2 = Number(form.get('n2'));
      const conf = form.get('conf');

      if ([sd1, sd2].some(v => !Number.isFinite(v) || v <= 0) || [n1, n2].some(v => !Number.isFinite(v) || v < 2)) {
        ciDiffMeanResult.innerHTML = '<p>ตรวจสอบว่าส่วนเบี่ยงเบน &gt; 0 และขนาดตัวอย่างอย่างน้อย 2</p>';
        return;
      }

      const diff = mean1 - mean2;
      let se, df;

      if (method === 'equal') {
        const pooledVar = (((n1 - 1) * sd1 * sd1) + ((n2 - 1) * sd2 * sd2)) / (n1 + n2 - 2);
        const sp = Math.sqrt(pooledVar);
        se = sp * Math.sqrt(1 / n1 + 1 / n2);
        df = n1 + n2 - 2;
      } else {
        se = Math.sqrt((sd1 * sd1) / n1 + (sd2 * sd2) / n2);
        const numerator = Math.pow((sd1 * sd1) / n1 + (sd2 * sd2) / n2, 2);
        const denominator = ((Math.pow(sd1, 4)) / (n1 * n1 * (n1 - 1))) + ((Math.pow(sd2, 4)) / (n2 * n2 * (n2 - 1)));
        df = numerator / denominator;
      }

      const crit = getTCritical(Math.floor(df), conf);
      const moe = crit * se;
      const lower = diff - moe;
      const upper = diff + moe;

      ciDiffMeanResult.innerHTML = `
        <strong>${method === 'equal' ? 'Equal variance' : 'Welch'} CI ${(Number(conf) * 100).toFixed(0)}%:</strong>
        <p>$\hat{\Delta} = ${diff.toFixed(3)}$, $SE = ${se.toFixed(3)}$, $t = ${crit.toFixed(3)}$</p>
        <p><strong>ช่วง:</strong> (${lower.toFixed(3)}, ${upper.toFixed(3)})</p>
        <p class="muted">ถ้าช่วงครอบคลุม 0 หมายถึงยังไม่มีหลักฐานชัดว่าค่าเฉลี่ยต่างกันที่ระดับความเชื่อมั่นที่เลือก</p>
      `;
      if (window.MathJax?.typeset) {
        MathJax.typeset([ciDiffMeanResult]);
      }
    });
  </script>
</body>
</html>
